<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Rediså­¦ä¹ ä¹‹è·¯(å…«)ï¼šStream | é¸¡æ¯›è’œçš®äº‹(â—&#39;â—¡&#39;â—)</title>

<link rel="shortcut icon" href="http://mofish.pily.life/favicon.ico?v=1689146956047">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="http://mofish.pily.life/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<style>
    hr {
        margin-top: 1rem;
        margin-bottom: 1rem;
        border: 0;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <style>
    /* å¯¼èˆªæ æ ·å¼ */
    .navbar {
        position: relative;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
        -ms-flex-align: center;
        align-items: center;
        -ms-flex-pack: justify;
        justify-content: space-between;
        padding: 0.5rem 1rem;
    }

    .navbar-brand {
        display: inline-block;
        padding-top: 0.3125rem;
        padding-bottom: 0.3125rem;
        margin-right: 1rem;
        font-size: 1.25rem;
        line-height: inherit;
        white-space: nowrap;
    }

    .navbar-brand:hover,
    .navbar-brand:focus {
        text-decoration: none;
    }

    .navbar-nav {
        display: -ms-flexbox;
        display: flex;
        -ms-flex-direction: column;
        flex-direction: column;
        padding-left: 0;
        margin-bottom: 0;
        list-style: none;
    }

    .navbar-collapse {
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        -ms-flex-positive: 1;
        flex-grow: 1;
        -ms-flex-align: center;
        align-items: center;
    }

    .navbar-toggler {
        padding: 0.25rem 0.75rem;
        font-size: 1.25rem;
        line-height: 1;
        background-color: transparent;
        border: 1px solid transparent;
        border-radius: 0.25rem;
    }

    .navbar-toggler:hover,
    .navbar-toggler:focus {
        text-decoration: none;
    }

    @media (min-width: 992px) {
        .navbar-expand-lg {
            -ms-flex-flow: row nowrap;
            flex-flow: row nowrap;
            -ms-flex-pack: start;
            justify-content: flex-start;
        }

        .navbar-expand-lg .navbar-nav {
            -ms-flex-direction: row;
            flex-direction: row;
        }

        .navbar-expand-lg .navbar-collapse {
            display: -ms-flexbox !important;
            display: flex !important;
            -ms-flex-preferred-size: auto;
            flex-basis: auto;
        }

        .navbar-expand-lg .navbar-toggler {
            display: none;
        }
    }

    @media (max-width: 991px) {
        #navbarSupportedContent {
            display: none;
        }
    }
</style>
<nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="å¤´åƒ">
        <div class="site-name gt-c-content-color-first">
            é¸¡æ¯›è’œçš®äº‹(â—&#39;â—¡&#39;â—)
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    é¦–é¡µ
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    æ ‡ç­¾
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    å½’æ¡£
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    å…³äº
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1689146956047"
                action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="æœç´¢æ–‡ç« " />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* ç§»åŠ¨ç«¯å¯¼èˆªæ å±•å¼€/æ”¶èµ·åˆ‡æ¢ */
    document.getElementById('changeNavbar').onclick = function () {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>
    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    Rediså­¦ä¹ ä¹‹è·¯(å…«)ï¼šStream
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        Â· 2021-09-22 Â·
                    </time>
                    
                        <a href="http://mofish.pily.life/tag/P-RRy8DydH/" class="post-tags">
                            # redis
                        </a>
                    
                </div>
                <div class="post-content">
                    <p>ğŸ˜š Stream æ˜¯ Redis 5.0 ç‰ˆæœ¬æ–°å¢åŠ çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå¼¥è¡¥ List å’Œ Pub/Sub æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½çš„ä¸è¶³ã€‚<br>
ğŸ‘ å…¶æä¾›äº†æ¶ˆæ¯çš„æŒä¹…åŒ–å’Œä¸»å¤‡å¤åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥è®©ä»»ä½•å®¢æˆ·ç«¯è®¿é—®ä»»ä½•æ—¶åˆ»çš„æ•°æ®ï¼Œå¹¶ä¸”èƒ½è®°ä½æ¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„è®¿é—®ä½ç½®ï¼Œè¿˜èƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚</p>
<!-- more -->
<h2 id="ç›®å½•">ç›®å½•</h2>
<ul>
<li><a href="#ç®€è¿°">ç®€è¿°</a></li>
<li><a href="#æ¶ˆæ¯IDå’Œæ¶ˆæ¯å†…å®¹">æ¶ˆæ¯IDå’Œæ¶ˆæ¯å†…å®¹</a></li>
<li><a href="#å¢åˆ æ”¹æŸ¥">å¢åˆ æ”¹æŸ¥</a></li>
<li><a href="#ç‹¬ç«‹æ¶ˆè´¹">ç‹¬ç«‹æ¶ˆè´¹</a></li>
<li><a href="#åˆ›å»ºæ¶ˆè´¹ç»„">åˆ›å»ºæ¶ˆè´¹ç»„</a></li>
<li><a href="#æ¶ˆè´¹">æ¶ˆè´¹</a></li>
<li><a href="#PELå¦‚ä½•é¿å…æ¶ˆæ¯ä¸¢å¤±">PELå¦‚ä½•é¿å…æ¶ˆæ¯ä¸¢å¤±</a></li>
<li><a href="#Streamçš„é«˜å¯ç”¨">Streamçš„é«˜å¯ç”¨</a></li>
</ul>
<br>
<h2 id="a-nameç®€è¿°ç®€è¿°a"><a name="ç®€è¿°">ç®€è¿°</a></h2>
<p>Stream æ˜¯ä¸€ä¸ªæ–°çš„å¼ºå¤§çš„æ”¯æŒå¤šæ’­çš„å¯æŒä¹…åŒ–æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå…¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure data-type="image" tabindex="1"><img src="http://mofish.pily.life/post-images/1632294851176.png" alt="" loading="lazy"></figure>
<p>å®ƒæœ‰ä¸€ä¸ªæ¶ˆæ¯é“¾è¡¨ï¼Œå°†æ‰€æœ‰åŠ å…¥çš„ä¿¡æ¯éƒ½ä¸²èµ·æ¥ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IDå’Œå¯¹åº”çš„å†…å®¹ã€‚</p>
<pre><code>æ­¤å¤–ï¼Œæ¶ˆæ¯æ˜¯æŒä¹…åŒ–çš„ï¼ŒRedisé‡å¯åï¼Œå†…å®¹è¿˜åœ¨ï¼Œä¸ä¼šä¸¢å¤±ã€‚
</code></pre>
<p>æ¯ä¸ª <code>Stream</code> éƒ½æœ‰å”¯ä¸€çš„åç§°ï¼Œå°±æ˜¯å…¶å¯¹åº”çš„ Keyï¼Œåœ¨æˆ‘ä»¬é¦–æ¬¡ä½¿ç”¨ xadd æŒ‡ä»¤è¿½åŠ æ¶ˆæ¯æ—¶è‡ªåŠ¨åˆ›å»ºã€‚</p>
<p>æ¯ä¸ª <code>Stream</code> éƒ½å¯ä»¥æŒ‚å¤šä¸ª<code>æ¶ˆè´¹ç»„</code>ï¼ˆConsumer Groupï¼‰ï¼Œæ¯ä¸ª<code>æ¶ˆè´¹ç»„</code>éƒ½ä¼šæœ‰ä¸ªæ¸¸æ ‡ last_delivered_id <code>åœ¨Stream</code> æ•°ç»„ä¹‹ä¸Šå¾€å‰ç§»åŠ¨ï¼Œè¡¨ç¤ºå½“å‰<code>æ¶ˆè´¹ç»„</code>å·²ç»æ¶ˆè´¹åˆ°å“ªæ¡ä¿¡æ¯äº†ã€‚</p>
<p>å¦å¤–æ¯ä¸ª<code>æ¶ˆè´¹ç»„</code>éƒ½æœ‰ä¸€ä¸ª <code>Stream</code> å†…å”¯ä¸€çš„åç§°ï¼Œæ¶ˆè´¹è€…ä¸ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œå®ƒéœ€è¦å•ç‹¬çš„æŒ‡ä»¤ xgroup create è¿›è¡Œåˆ›å»ºï¼Œéœ€è¦æŒ‡å®šä» <code>Stream</code> çš„æŸä¸ªæ¶ˆæ¯ ID å¼€å§‹æ¶ˆè´¹ï¼Œè¿™ä¸ª ID ç”¨æ¥åˆå§‹åŒ– last_deliverer_id å˜é‡ã€‚</p>
<p>æ¯ä¸ª<code>æ¶ˆè´¹ç»„</code>çš„çŠ¶æ€éƒ½æ˜¯<strong>ç‹¬ç«‹çš„</strong>ï¼Œ<strong>äº’ä¸å½±å“</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€ä»½<code>Stream</code>å†…éƒ¨çš„æ¶ˆæ¯ä¼šè¢«æ¯ä¸ªæ¶ˆè´¹ç»„æ¶ˆè´¹åˆ°ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒåŒä¸€ä¸ª<code>æ¶ˆè´¹ç»„</code>å¯ä»¥æŒ‚æ¥å¤šä¸ª<code>æ¶ˆè´¹è€…</code>ï¼ˆConsumerï¼‰ï¼Œè¿™äº›<code>æ¶ˆè´¹è€…</code>ä¹‹é—´æ˜¯<strong>ç«äº‰å…³ç³»</strong>ï¼Œ<strong>ä»»æ„ä¸€ä¸ª</strong><code>æ¶ˆè´¹è€…</code>è¯»å–äº†æ¶ˆæ¯éƒ½ä¼šä½¿æ¸¸æ ‡ last_delivered_id å¾€å‰ç§»åŠ¨ï¼Œæ¯ä¸ª<code>æ¶ˆè´¹è€…</code>æœ‰ä¸€ä¸ªç»„å†…å”¯ä¸€åç§°ã€‚</p>
<p>æˆ‘ä»¬ä»å›¾ä¸­è§‚å¯Ÿåˆ°ï¼Œæ¶ˆè´¹è€…å†…éƒ¨ä¼šæœ‰ä¸€ä¸ªçŠ¶æ€å˜é‡pending_idsï¼Œå®ƒè®°å½•äº†å½“å‰å·²ç»è¢«å®¢æˆ·ç«¯è¯»å–ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ ask çš„æ¶ˆæ¯ï¼Œè¿™ä¸ª pending_ids å˜é‡åœ¨ Redis å®˜æ–¹è¢«ç§°ä¸º PELï¼Œä¹Ÿå°±æ˜¯ Pending Entries Listï¼Œæ˜¯ä¸€ä¸ªæ ¸å¿ƒçš„æ•°æ®ç»“æ„ï¼Œå®ƒç”¨æ¥ç¡®è®¤å®¢æˆ·ç«¯<strong>è‡³å°‘æ¶ˆè´¹äº†æ¶ˆæ¯ä¸€æ¬¡</strong>ï¼Œè€Œä¸ä¼šå†ç½‘ç»œä¼ è¾“çš„ä¸­é€”ä¸¢å¤±äº†è€Œæ²¡è¢«å¤„ç†ã€‚</p>
<hr>
<br>
<h2 id="a-nameæ¶ˆæ¯idå’Œæ¶ˆæ¯å†…å®¹æ¶ˆæ¯idå’Œæ¶ˆæ¯å†…å®¹a"><a name="æ¶ˆæ¯IDå’Œæ¶ˆæ¯å†…å®¹">æ¶ˆæ¯IDå’Œæ¶ˆæ¯å†…å®¹</a></h2>
<p><code>æ¶ˆæ¯ID</code>çš„å½¢å¼æ˜¯ timestampInMillis-sequenceï¼Œä¾‹å¦‚1527846880572-5ï¼Œå®ƒè¡¨ç¤ºå½“å‰çš„æ¶ˆæ¯å†æ¯«ç±³æ—¶é—´æˆ³ 1527846880572 æ—¶äº§ç”Ÿï¼Œå¹¶ä¸”æ˜¯è¯¥æ¯«ç§’å†…äº§ç”Ÿçš„ç¬¬ 5 æ¡æ¶ˆæ¯ã€‚</p>
<p><code>æ¶ˆæ¯ID</code>å¯ä»¥ç”±æœåŠ¡å™¨è‡ªåŠ¨ç”Ÿäº§ï¼Œä¹Ÿå¯ä»¥ç”±å®¢æˆ·ç«¯è‡ªå·±æŒ‡å®šï¼Œä½†æ˜¯å½¢å¼<strong>å¿…é¡»</strong>æ˜¯**â€œæ•´æ•°-æ•´æ•°â€**ï¼Œè€Œä¸”åé¢åŠ å…¥çš„IDå¿…é¡»å¤§äºå‰é¢çš„<code>æ¶ˆæ¯ID</code>ã€‚</p>
<p><code>æ¶ˆæ¯å†…å®¹</code>å°±æ˜¯é”®å€¼å¯¹ï¼Œæ²¡å•¥ç‰¹åˆ«çš„ã€‚</p>
<hr>
<br>
<h2 id="a-nameå¢åˆ æ”¹æŸ¥å¢åˆ æ”¹æŸ¥a"><a name="å¢åˆ æ”¹æŸ¥">å¢åˆ æ”¹æŸ¥</a></h2>
<ul>
<li>xaddï¼šå‘ Stream è¿½åŠ æ¶ˆæ¯</li>
</ul>
<pre><code class="language-shell"># * å·è¡¨ç¤ºæœåŠ¡å™¨è‡ªåŠ¨ç”ŸæˆIDï¼Œåé¢é¡ºåºè·Ÿç€ key å’Œ value
# åå­—å« dogï¼Œå¹´é¾„ 27 å²
127.0.0.1:6379&gt; xadd codehole * name dog age 27
&quot;1632301447116-0&quot;
127.0.0.1:6379&gt; xadd codehole * name pily age 18
&quot;1632301478393-0&quot;
127.0.0.1:6379&gt; xadd codehole * name ultraman age 99
&quot;1632301500592-0&quot;
</code></pre>
<ul>
<li>xlenï¼šè·å– Stream æ¶ˆæ¯é•¿åº¦</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; xlen codehole
(integer) 3
</code></pre>
<ul>
<li>xrangeï¼šè·å– Stream ä¸­çš„æ¶ˆæ¯åˆ—è¡¨ï¼Œä¼šè‡ªåŠ¨è¿‡æ»¤å·²ç»åˆ é™¤çš„æ¶ˆæ¯</li>
</ul>
<pre><code class="language-shell"># - è¡¨ç¤ºæœ€å°å€¼  + è¡¨ç¤ºæœ€å¤§å€¼
127.0.0.1:6379&gt; xrange codehole - +
1) 1) &quot;1632301447116-0&quot;
   2) 1) &quot;name&quot;
      2) &quot;moyuxing&quot;
      3) &quot;age&quot;
      4) &quot;27&quot;
2) 1) &quot;1632301478393-0&quot;
   2) 1) &quot;name&quot;
      2) &quot;pily&quot;
      3) &quot;age&quot;
      4) &quot;18&quot;
3) 1) &quot;1632301500592-0&quot;
   2) 1) &quot;name&quot;
      2) &quot;ultraman&quot;
      3) &quot;age&quot;
      4) &quot;99&quot;

# æŒ‡å®šæœ€å°æ¶ˆæ¯ ID çš„åˆ—è¡¨
127.0.0.1:6379&gt; xrange codehole 1632301478393-0 +
1) 1) &quot;1632301478393-0&quot;
   1) 1) &quot;name&quot;
      1) &quot;pily&quot;
      2) &quot;age&quot;
      3) &quot;18&quot;
2) 1) &quot;1632301500592-0&quot;
   1) 1) &quot;name&quot;
      1) &quot;ultraman&quot;
      2) &quot;age&quot;
      3) &quot;99&quot;

# æŒ‡å®šæœ€å¤§æ¶ˆæ¯ ID çš„åˆ—è¡¨
127.0.0.1:6379&gt; xrange codehole - 1632301478393-0
1) 1) &quot;1632301447116-0&quot;
   2) 1) &quot;name&quot;
      2) &quot;moyuxing&quot;
      3) &quot;age&quot;
      4) &quot;27&quot;
2) 1) &quot;1632301478393-0&quot;
   2) 1) &quot;name&quot;
      2) &quot;pily&quot;
      3) &quot;age&quot;
      4) &quot;18&quot;
</code></pre>
<ul>
<li>xdelï¼šä» Stream ä¸­åˆ é™¤æ¶ˆæ¯</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; xdel codehole 1632301478393-0
(integer) 1
127.0.0.1:6379&gt; xlen codehole
(integer) 2
# åˆ é™¤çš„æ¶ˆæ¯æ²¡äº†
127.0.0.1:6379&gt; xrange codehole - +
1) 1) &quot;1632301447116-0&quot;
   2) 1) &quot;name&quot;
      2) &quot;moyuxing&quot;
      3) &quot;age&quot;
      4) &quot;27&quot;
2) 1) &quot;1632301500592-0&quot;
   2) 1) &quot;name&quot;
      2) &quot;ultraman&quot;
      3) &quot;age&quot;
      4) &quot;99&quot;
</code></pre>
<ul>
<li>delï¼šåˆ é™¤æ•´ä¸ª Stream æ¶ˆæ¯åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ¶ˆæ¯</li>
</ul>
<pre><code class="language-shell"># åˆ é™¤æ•´ä¸ªStream
127.0.0.1:6379&gt; del codehole
(integer) 1
127.0.0.1:6379&gt; xlen codehole
(integer) 0
</code></pre>
<hr>
<br>
<h2 id="a-nameç‹¬ç«‹æ¶ˆè´¹ç‹¬ç«‹æ¶ˆè´¹a"><a name="ç‹¬ç«‹æ¶ˆè´¹">ç‹¬ç«‹æ¶ˆè´¹</a></h2>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸å®šä¹‰<code>æ¶ˆè´¹ç»„</code>çš„æƒ…å†µä¸‹è¿›è¡Œ Stream æ¶ˆæ¯çš„<strong>ç‹¬ç«‹æ¶ˆè´¹</strong>ï¼Œå½“ Stream æ²¡æœ‰æ–°çš„æ¶ˆæ¯æ—¶ï¼Œç”šè‡³å¯ä»¥é˜»å¡ç­‰å¾…ã€‚</p>
<p>Redis è®¾è®¡äº†ä¸€ä¸ªå•ç‹¬çš„æ¶ˆè´¹æŒ‡ä»¤<strong>xread</strong>ï¼Œå¯ä»¥å°† Stream å½“æˆæ™®é€šçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆlistï¼‰æ¥ä½¿ç”¨ã€‚</p>
<pre><code class="language-shell"># ä» Stream å¤´éƒ¨è¯»å–ä¸¤æ¡æ¶ˆæ¯ï¼ˆé‡æ–°æ’å…¥å‰é¢ä¸‰æ¡ä¿¡æ¯ï¼‰
127.0.0.1:6379&gt; xread count 2 streams codehole 0-0
1) 1) &quot;codehole&quot;
   2) 1) 1) &quot;1632304533303-0&quot;
         2) 1) &quot;name&quot;
            2) &quot;moyuxing&quot;
            3) &quot;age&quot;
            4) &quot;27&quot;
      2) 1) &quot;1632304538029-0&quot;
         2) 1) &quot;name&quot;
            2) &quot;pily&quot;
            3) &quot;age&quot;
            4) &quot;18&quot;
   
# ä» Stream å°¾éƒ¨è¯»å–ä¸€æ¡æ–°çš„æ¶ˆæ¯ï¼Œ$ è¡¨æ˜åªè¦ Stream ä¸­çš„æ–°æ•°æ®
# ï¼ˆæ¯«æ— ç–‘é—®ï¼Œè¿™é‡Œä¸ä¼šè¿”å›ä»»ä½•æ•°æ®ï¼Œå› ä¸ºæ²¡æœ‰æ–°æ•°æ®è¿›æ¥ï¼‰
127.0.0.1:6379&gt; xread count 1 streams codehole $
(nil)

# ä»å°¾éƒ¨é˜»å¡ç­‰å¾…æ–°æ¶ˆæ¯åˆ°æ¥ï¼Œä¸‹é¢çš„æŒ‡ä»¤ä¼šå µä½ï¼Œç›´åˆ°æ–°æ¶ˆæ¯åˆ°æ¥
127.0.0.1:6379&gt; xread block 0 count 1 streams codehole $

# æ–°æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œé€šè¿‡è¿™ä¸ªçª—å£å¾€ Stream é‡Œæ’å…¥ä¸€æ¡ä¿¡æ¯
127.0.0.1:6379&gt; xadd codehole * name xiaohong age 16
&quot;1632381201794-0&quot;

# å†åˆ‡åˆ°ç¬¬ä¸€ä¸ªçª—å£ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é˜»å¡è§£é™¤äº†ï¼Œå¹¶è¿”å›äº†æ–°çš„æ¶ˆæ¯å†…å®¹å’Œç­‰å¾…æ—¶é—´
127.0.0.1:6379&gt; xread block 0 count 1 streams codehole $
1) 1) &quot;codehole&quot;
   2) 1) 1) &quot;1632381201794-0&quot;
         2) 1) &quot;name&quot;
            2) &quot;xiaohong&quot;
            3) &quot;age&quot;
            4) &quot;16&quot;
(1.84s)
</code></pre>
<p>å®¢æˆ·ç«¯å¦‚æœæƒ³è¦ä½¿ç”¨ xread è¿›è¡Œé¡ºåºæ¶ˆè´¹ï¼Œé‚£ä¹ˆä¸€å®šè¦è®°ä½å½“å‰æ¶ˆè´¹åˆ°å“ªé‡Œï¼Œä¹Ÿå°±æ˜¯è¿”å›çš„<code>æ¶ˆæ¯ID</code>ã€‚ä¸‹æ¬¡å†ç»§ç»­è°ƒç”¨ xread æ—¶ï¼Œå¯ç»§ç»­æ¶ˆè´¹åç»­çš„ä¿¡æ¯ï¼Œ<strong>é¿å…é‡å¤æ¶ˆè´¹</strong>ã€‚</p>
<p>block ä¸º 0 æ—¶è¡¨ç¤ºæ°¸è¿œé˜»å¡ï¼Œç›´åˆ°æ¶ˆæ¯åˆ°æ¥ï¼›block ä¸º 1000 è¡¨ç¤ºé˜»å¡ 1sï¼Œå¦‚æœ 1s å†…æ²¡æœ‰ä»»ä½•æ¶ˆæ¯åˆ°æ¥ï¼Œåˆ™è¿”å› nilã€‚</p>
<pre><code class="language-shell">127.0.0.1:6379&gt; xread block 1000 count 1 streams codehole $
(nil)
(1.08s)
</code></pre>
<hr>
<br>
<h2 id="a-nameåˆ›å»ºæ¶ˆè´¹ç»„åˆ›å»ºæ¶ˆè´¹ç»„a"><a name="åˆ›å»ºæ¶ˆè´¹ç»„">åˆ›å»ºæ¶ˆè´¹ç»„</a></h2>
<p>Stream é€šè¿‡ xgroup create æŒ‡ä»¤åˆ›å»ºæ¶ˆè´¹ç»„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>
<img src="http://mofish.pily.life/post-images/1632384574743.png" alt="" loading="lazy"></p>
<pre><code>æ³¨æ„ï¼šåˆ›å»ºæ¶ˆè´¹ç»„éœ€è¦æä¾›èµ·å§‹ä¿¡æ¯ ID å‚æ•°ç”¨æ¥åˆå§‹åŒ– last_delivered_id å˜é‡ã€‚
</code></pre>
<pre><code class="language-shell"># è¡¨ç¤ºä»å¤´å¼€å§‹æ¶ˆè´¹
127.0.0.1:6379&gt; xgroup create codehole cg1 0-0
OK

# $ è¡¨ç¤ºä»å°¾éƒ¨å¼€å§‹æ¶ˆè´¹ï¼Œåªæ¥å—æ–°æ¶ˆæ¯ï¼Œå½“å‰ Stream æ¶ˆæ¯ä¼šå…¨éƒ¨å¿½ç•¥
127.0.0.1:6379&gt; xgroup create codehole cg2 $
OK

# è·å– Stream ä¿¡æ¯
127.0.0.1:6379&gt; xinfo stream codehole
 1) &quot;length&quot;
 2) (integer) 3                                    # å…± 3 ä¸ªæ¶ˆæ¯
 3) &quot;radix-tree-keys&quot;
 4) (integer) 1
 5) &quot;radix-tree-nodes&quot;
 6) (integer) 2
 7) &quot;groups&quot;
 8) (integer) 2                                    # å…± 2 ä¸ªæ¶ˆè´¹ç»„
 9) &quot;last-generated-id&quot;
10) &quot;1632385551651-0&quot;
11) &quot;first-entry&quot;                                 # ç¬¬ 1 ä¸ªæ¶ˆæ¯
12) 1) &quot;1632385524922-0&quot;
    2) 1) &quot;name&quot;
       2) &quot;pily&quot;
       3) &quot;age&quot;
       4) &quot;18&quot;
13) &quot;last-entry&quot;                                 # åšåä¸€ä¸ªæ¶ˆæ¯
14) 1) &quot;1632385551651-0&quot;
    2) 1) &quot;name&quot;
       2) &quot;john&quot;
       3) &quot;age&quot;
       4) &quot;88&quot;

# è·å– Stream æ¶ˆè´¹ç»„ä¿¡æ¯
1) 1) &quot;name&quot;
   2) &quot;cg1&quot;
   3) &quot;consumers&quot;
   4) (integer) 0                             # è¯¥æ¶ˆè´¹è€…æ²¡æœ‰æ¶ˆè´¹è€…
   5) &quot;pending&quot;
   6) (integer) 0                            # è¯¥æ¶ˆè´¹è€…æ²¡æœ‰æ­£åœ¨å¤„ç†çš„æ¶ˆæ¯
   7) &quot;last-delivered-id&quot;
   8) &quot;0-0&quot;
2) 1) &quot;name&quot;
   2) &quot;cg2&quot;
   3) &quot;consumers&quot;
   4) (integer) 0
   5) &quot;pending&quot;
   6) (integer) 0
   7) &quot;last-delivered-id&quot;
   8) &quot;1632385551651-0&quot;
</code></pre>
<hr>
<br>
<h2 id="a-nameæ¶ˆè´¹æ¶ˆè´¹a"><a name="æ¶ˆè´¹">æ¶ˆè´¹</a></h2>
<p>Stream æä¾›äº† xreadgroup æŒ‡ä»¤å¯ä»¥è¿›è¡Œæ¶ˆè´¹ç»„çš„<code>ç»„å†…æ¶ˆè´¹</code>ï¼Œéœ€è¦æä¾›<strong>æ¶ˆè´¹ç»„åç§°</strong>ã€<strong>æ¶ˆè´¹è€…åç§°</strong>å’Œ<strong>èµ·å§‹æ¶ˆæ¯ID</strong>ã€‚</p>
<p>å®ƒåŒ xread ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥é˜»å¡ç­‰å¾…æ–°ä¿¡æ¯ï¼Œè¯»åˆ°æ–°ä¿¡æ¯åï¼Œå¯¹åº”çš„æ¶ˆæ¯IDå°±ä¼šè¿›å…¥æ¶ˆè´¹è€…çš„ PEL ï¼ˆæ­£åœ¨å¤„ç†çš„æ¶ˆæ¯ï¼‰ç»“æ„é‡Œï¼Œå®¢æˆ·ç«¯å¤„ç†å®Œæ¯•åä½¿ç”¨ xack æŒ‡ä»¤é€šçŸ¥æœåŠ¡å™¨åï¼Œè¡¨ç¤ºè¯¥æ¶ˆæ¯å·²å¤„ç†å®Œæ¯•ï¼Œè¯¥æ¶ˆæ¯ ID å°±ä¼šä» PEL ä¸­<strong>ç§»é™¤</strong>ã€‚</p>
<pre><code class="language-shell"># &gt; å·è¡¨ç¤ºä»å½“å‰æ¶ˆè´¹ç»„çš„ last_delivered_id åé¢å¼€å§‹è¯»
# æ¯å½“æ¶ˆè´¹è€…è¯»å–ä¸€æ¡æ¶ˆæ¯ï¼Œ last_delivered_id å˜é‡å°±ä¼šå‰è¿›
127.0.0.1:6379&gt; xreadgroup Group cg1 c1 count 1 streams codehole &gt;
1) 1) &quot;codehole&quot;
   2) 1) 1) &quot;1632388256718-0&quot;
         2) 1) &quot;name&quot;
            2) &quot;pily&quot;
            3) &quot;age&quot;
            4) &quot;18&quot;
127.0.0.1:6379&gt; xreadgroup Group cg1 c1 count 1 streams codehole &gt;
1) 1) &quot;codehole&quot;
   2) 1) 1) &quot;1632388264858-0&quot;
         2) 1) &quot;name&quot;
            2) &quot;ultraman&quot;
            3) &quot;age&quot;
            4) &quot;22&quot;
127.0.0.1:6379&gt; xreadgroup Group cg1 c1 count 2 streams codehole &gt;
1) 1) &quot;codehole&quot;
   2) 1) 1) &quot;1632388271050-0&quot;
         2) 1) &quot;name&quot;
            2) &quot;john&quot;
            3) &quot;age&quot;
            4) &quot;88&quot;

# å†ç»§ç»­è¯»å–å°±æ²¡æœ‰æ¶ˆæ¯äº†
127.0.0.1:6379&gt; xreadgroup Group cg1 c1 count 1 streams codehole &gt;
(nil)

# é˜»å¡ç­‰å¾…æ¥æ”¶æ¶ˆæ¯
127.0.0.1:6379&gt; xreadgroup group cg1 c1 block 0 count 1 streams codehole &gt;

# å¼€å¯å¦å¤–ä¸€ä¸ªçª—å£ï¼Œå¾€é‡Œé¢å¡æ¶ˆæ¯
127.0.0.1:6379&gt; xadd codehole * name marry age 24
&quot;1632388420051-0&quot;

# å›åˆ°å‰ä¸€ä¸ªçª—å£ï¼Œå‘ç°é˜»å¡è§£é™¤ï¼Œæ”¶åˆ°äº†æ–°çš„æ¶ˆæ¯
127.0.0.1:6379&gt; xreadgroup group cg1 c1 block 0 count 1 streams codehole &gt;
1) 1) &quot;codehole&quot;
   2) 1) 1) &quot;1632388420051-0&quot;
         2) 1) &quot;name&quot;
            2) &quot;marry&quot;
            3) &quot;age&quot;
            4) &quot;24&quot;
(12.63s)

# 
127.0.0.1:6379&gt; xinfo groups codehole
1) 1) &quot;name&quot;
   2) &quot;cg1&quot;
   3) &quot;consumers&quot;
   4) (integer) 1                             # 1 ä¸ªæ¶ˆè´¹è€…
   5) &quot;pending&quot;
   6) (integer) 4                             # å…± 4 æ¡å¾…å¤„ç†ä¿¡æ¯è¿˜æ²¡æœ‰ ack
   7) &quot;last-delivered-id&quot;
   8) &quot;1632388420051-0&quot;
2) 1) &quot;name&quot;
   2) &quot;cg2&quot;
   3) &quot;consumers&quot;
   4) (integer) 0                             # æ¶ˆè´¹ç»„ cg2 æ²¡æœ‰å˜åŒ–ï¼Œå› ä¸ºå‰é¢éƒ½åœ¨æ“ä½œ cg1
   5) &quot;pending&quot;
   6) (integer) 0
   7) &quot;last-delivered-id&quot;
   8) &quot;1632388271050-0&quot;

# å¦‚æœåŒä¸€ä¸ªæ¶ˆè´¹ç»„æœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œåˆ™å¯ä»¥é€šè¿‡ xinfo cunsumers æŒ‡ä»¤è§‚å¯Ÿæ¯ä¸ªæ¶ˆè´¹è€…çš„çŠ¶æ€
127.0.0.1:6379&gt; xinfo consumers codehole cg1
1) 1) &quot;name&quot;
   2) &quot;c1&quot;
   3) &quot;pending&quot;
   4) (integer) 4                      # å…± 4 æ¡ä¿¡æ¯å¾…å¤„ç†
   5) &quot;idle&quot;
   6) (integer) 524136            # ç©ºé—²äº†å¤šå°‘msæ²¡æœ‰è¯»å–æ¶ˆæ¯äº†

# æ¥ä¸‹æ¥æˆ‘ä»¬ ack ä¸€æ¡ä¿¡æ¯
127.0.0.1:6379&gt; xack codehole cg1 1632388256718-0
(integer) 1
# å¾…å¤„ç†çš„ä¿¡æ¯å˜æˆ 3 æ¡
127.0.0.1:6379&gt; xinfo consumers codehole cg1
1) 1) &quot;name&quot;
   2) &quot;c1&quot;
   3) &quot;pending&quot;
   4) (integer) 3
   5) &quot;idle&quot;
   6) (integer) 655723

# æŠŠæ‰€æœ‰çš„ä¿¡æ¯éƒ½ ack æ‰
127.0.0.1:6379&gt; xack codehole cg1 1632388420051-0 1632388264858-0 1632388271050-0
(integer) 3
# PEL ç©ºäº†ï¼Œæ²¡æœ‰å¾…å¤„ç†æ¶ˆæ¯äº†
127.0.0.1:6379&gt; xinfo consumers codehole cg1
1) 1) &quot;name&quot;
   2) &quot;c1&quot;
   3) &quot;pending&quot;
   4) (integer) 0
   5) &quot;idle&quot;
   6) (integer) 775588
</code></pre>
<hr>
<br>
<h2 id="a-namepelå¦‚ä½•é¿å…æ¶ˆæ¯ä¸¢å¤±pelå¦‚ä½•é¿å…æ¶ˆæ¯ä¸¢å¤±a"><a name="PELå¦‚ä½•é¿å…æ¶ˆæ¯ä¸¢å¤±">PELå¦‚ä½•é¿å…æ¶ˆæ¯ä¸¢å¤±</a></h2>
<p>å½“å®¢æˆ·ç«¯æ¶ˆè´¹è€…è¯»å– Stream æ¶ˆæ¯æ—¶ï¼Œåœ¨ Redis æœåŠ¡å™¨å°†æ¶ˆæ¯å›å¤ç»™å®¢æˆ·ç«¯çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯çªç„¶æ–­å¼€äº†è¿æ¥ï¼Œé‚£ä¸ªè¿™ä¸ªæ¶ˆæ¯å®¢æˆ·è¿˜æ²¡è¢«å®¢æˆ·ç«¯æ”¶åˆ°å°±ä¸¢å¤±äº†ã€‚</p>
<p>ä¸è¿‡æ²¡æœ‰å…³ç³»ï¼ŒPEL é‡Œå·²ç»ä¿å­˜äº†å‘å‡ºå»çš„æ¶ˆæ¯IDï¼Œå¾…å®¢æˆ·ç«¯é‡æ–°è¿æ¥ä¸Šä¹‹åï¼Œå¯ä»¥å†æ¬¡æ”¶åˆ°PEL ä¸­çš„æ¶ˆæ¯IDã€‚</p>
<hr>
<br>
<h2 id="a-namestreamçš„é«˜å¯ç”¨streamçš„é«˜å¯ç”¨a"><a name="Streamçš„é«˜å¯ç”¨">Streamçš„é«˜å¯ç”¨</a></h2>
<p>Stream çš„é«˜å¯ç”¨æ˜¯<code>å»ºç«‹åœ¨ä¸»ä»å¤åˆ¶åŸºç¡€</code>ä¸Šçš„ï¼Œå®ƒå’Œå…¶å®ƒæ•°æ®ç»“æ„çš„å¤åˆ¶æœºåˆ¶æ²¡æœ‰åŒºåˆ«ï¼Œä¹Ÿå°±æ˜¯è¯´å† Sentinel å’Œ Cluster é›†ç¾¤ç¯å¢ƒä¸‹ï¼ŒStream æ˜¯å¯ä»¥æ”¯æŒé«˜å¯ç”¨çš„ã€‚</p>
<p>ä¸è¿‡é‰´äº Redis çš„æŒ‡ä»¤å¤åˆ¶æ˜¯å¼‚æ­¥çš„ï¼Œåœ¨ failover å‘ç”Ÿæ—¶ï¼ŒRedis å¯èƒ½ä¼šä¸¢å¤±æå°éƒ¨åˆ†æ•°æ®ï¼Œè¿™ä¸€ç‚¹ Redis çš„å…¶ä»–æ•°æ®æ¥å£ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>
<pre><code>æ•…éšœfailoverè¡¨ç°åœ¨ä¸€ä¸ªmasteråˆ†ç‰‡æ•…éšœåï¼Œslaveæ¥ç®¡masterçš„è¿‡ç¨‹ã€‚
</code></pre>
<hr>
<br>
<h2 id="a-nameå°ç»“å°ç»“a"><a name="å°ç»“">å°ç»“</a></h2>
<p>Stream çš„æ¶ˆè´¹æ¨¡å‹å€Ÿé‰´äº† Kafka çš„æ¶ˆè´¹åˆ†ç»„çš„æ¦‚å¿µï¼Œå¼¥è¡¥äº† Redis PubSub ä¸èƒ½æŒä¹…åŒ–æ¶ˆæ¯çš„ç¼ºé™·ã€‚ Stream åˆä¸ç”¨äºKafka çš„æ¶ˆæ¯å¯ä»¥åˆ† Partitionï¼Œè€Œ Stream ä¸è¡Œã€‚</p>
<p>å¦‚æœéè¦åˆ† Partition çš„è¯ï¼Œ å¾—åœ¨å®¢æˆ·ç«¯åšï¼Œæä¾›ä¸åŒçš„ Stream åç§°ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œ hash å–æ¨¡æ¥é€‰æ‹©å¾€å“ªä¸ª Stream é‡Œå¡ã€‚</p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">ä¸‹ä¸€ç¯‡</div>
                <a href="http://mofish.pily.life/post/data_structure_04/" class="post-title gt-a-link">
                    æ•°æ®ç»“æ„å­¦ä¹ ä¹‹è·¯(å››)ï¼šZipListå‹ç¼©é“¾è¡¨
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">æ‰“å·¥äººï¼æ‰“å·¥é­‚ï¼æˆ‘çˆ±æ‰“å·¥ï¼</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/myx1002/myx1002.github.io" target="_blank">Moyuxing</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="http://mofish.pily.life/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
