<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>wsl2环境搭建及常用命令（已迁移） | 鸡毛蒜皮事(●&#39;◡&#39;●)</title>

<link rel="shortcut icon" href="http://mofish.pily.life/favicon.ico?v=1689146956047">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="http://mofish.pily.life/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<style>
    hr {
        margin-top: 1rem;
        margin-bottom: 1rem;
        border: 0;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <style>
    /* 导航栏样式 */
    .navbar {
        position: relative;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
        -ms-flex-align: center;
        align-items: center;
        -ms-flex-pack: justify;
        justify-content: space-between;
        padding: 0.5rem 1rem;
    }

    .navbar-brand {
        display: inline-block;
        padding-top: 0.3125rem;
        padding-bottom: 0.3125rem;
        margin-right: 1rem;
        font-size: 1.25rem;
        line-height: inherit;
        white-space: nowrap;
    }

    .navbar-brand:hover,
    .navbar-brand:focus {
        text-decoration: none;
    }

    .navbar-nav {
        display: -ms-flexbox;
        display: flex;
        -ms-flex-direction: column;
        flex-direction: column;
        padding-left: 0;
        margin-bottom: 0;
        list-style: none;
    }

    .navbar-collapse {
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        -ms-flex-positive: 1;
        flex-grow: 1;
        -ms-flex-align: center;
        align-items: center;
    }

    .navbar-toggler {
        padding: 0.25rem 0.75rem;
        font-size: 1.25rem;
        line-height: 1;
        background-color: transparent;
        border: 1px solid transparent;
        border-radius: 0.25rem;
    }

    .navbar-toggler:hover,
    .navbar-toggler:focus {
        text-decoration: none;
    }

    @media (min-width: 992px) {
        .navbar-expand-lg {
            -ms-flex-flow: row nowrap;
            flex-flow: row nowrap;
            -ms-flex-pack: start;
            justify-content: flex-start;
        }

        .navbar-expand-lg .navbar-nav {
            -ms-flex-direction: row;
            flex-direction: row;
        }

        .navbar-expand-lg .navbar-collapse {
            display: -ms-flexbox !important;
            display: flex !important;
            -ms-flex-preferred-size: auto;
            flex-basis: auto;
        }

        .navbar-expand-lg .navbar-toggler {
            display: none;
        }
    }

    @media (max-width: 991px) {
        #navbarSupportedContent {
            display: none;
        }
    }
</style>
<nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            鸡毛蒜皮事(●&#39;◡&#39;●)
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1689146956047"
                action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = function () {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>
    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    wsl2环境搭建及常用命令（已迁移）
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2022-08-12 ·
                    </time>
                    
                        <a href="http://mofish.pily.life/tag/62-1bH5aj/" class="post-tags">
                            # linux
                        </a>
                    
                        <a href="http://mofish.pily.life/tag/qo6XPqkl5/" class="post-tags">
                            # php
                        </a>
                    
                </div>
                <div class="post-content">
                    <h1 id="一-wsl2安装">一、wsl2安装</h1>
<h3 id="1检验是否开启虚拟化">①检验是否开启虚拟化</h3>
<p>「Ctrl+Alt+Del」调出「安全选项」界面，选择启动「任务管理器」。「性能」选项卡显示「虚拟化：已启用」即可。<br>
<br></p>
<h3 id="2开启开发者模式">②开启开发者模式</h3>
<p>「开发者选项」→「开发人员模式」，打开开关。<br>
<br></p>
<h3 id="3开启windows功能">③开启Windows功能</h3>
<p>需要先启用「适用于 Linux 的 Windows 子系统」可选功能，然后才能在 Windows 上安装 Linux 分发。<br>
找到「控制面板」-「程序/功能」-「启用或关闭Windows功能」，选中「适用于Linux的Windows子系统」，然后点击确定。<br>
<br></p>
<h3 id="4升级wsl内核">④升级WSL内核</h3>
<p>适用于 x64 计算机的 WSL2 Linux 内核更新包<br>
<br></p>
<h3 id="5启用虚拟机功能">⑤启用虚拟机功能</h3>
<p>找到「控制面板」-「程序/功能」-「启用或关闭Windows功能」，选中「虚拟机平台」，然后点击确定。<br>
<br></p>
<h3 id="6设置默认wsl">⑥设置默认WSL</h3>
<p>将 WSL 2 设置为默认版本，打开 PowerShell，然后在安装新的 Linux 发行版时运行以下命令，将 WSL 2 设置为默认版本：</p>
<pre><code>wsl --set-default-version 2
</code></pre>
<p>参考：<a href="https://blog.csdn.net/m0_63969219/article/details/124632640">(34条消息) 适用于 Linux 的 Windows 10/11 子系统（WSL2）安装指南_江城撅嘴的川羌的博客-CSDN博客_wsl2</a></p>
<hr>
<h1 id="二-centos安装">二、centos安装</h1>
<h3 id="chocolatey">chocolatey</h3>
<p>Chocolatey 是基于 NuGet 的一个软件包管理器，就像 Linux 中的 yum 或 apt 一样，在 Windows10 中也可以用命令行安装程序了。</p>
<pre><code>Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))
</code></pre>
<br>
<h3 id="lxrunoffline">lxRunOffline</h3>
<p>LxRunOffline 是非常实用的 WSL 管理软件，可以备份、创建、恢复、导出WSL子系统，也可以安装适配 WSL 的任何 Linux 发行版，可以将 WSL 子系统安装到任意目录中。</p>
<pre><code>choco install lxrunoffline -y
</code></pre>
<br>
### centos（ubuntu同理）
首先需要自己下载对应的包
<pre><code>安装到指定的硬盘：
LxRunOffline.exe install -n centos -d D:\centos -f D:\centos-7.8.2003-x86_64-docker.tar.xz

设为wsl2方式：
wsl --set-version centos 2
</code></pre>
<hr>
<h1 id="三-系统导出导入">三、系统导出导入</h1>
<pre><code>导出系统：
wsl —export docker-desktop d:\docker\docker-desktop.tar

注销系统：
wsl —unregister docker-desktop

导入系统：
wsl —import docker-desktop d:\docker\docker-desktop d:\docker\docker-desktop.tar —version 2
</code></pre>
<p><strong>Ps：主要用于把系统移动到其它盘，防止占用C盘空间</strong></p>
<hr>
<h1 id="四-端口和ip固定启动设置">四、端口和ip固定启动设置</h1>
<pre><code>固定wsl2访问：
wsl -d centos -u root ip addr add 192.168.193.168/24 broadcast 192.168.207.255 dev eth0 label eth0:1
netsh interface ip add address &quot;vEthernet (WSL)&quot; 192.168.193.169 255.255.255.240

查看开放的端口列表：
netsh interface portproxy show all

设置开放端口：
netsh interface portproxy add v4tov4 listenport=外部访问端口 listenaddress=0.0.0.0 connectport=内网访问端口 connectaddress=wsl2内部固定ip

删除开放端口：
netsh interface portproxy delete v4tov4 listenport=3000 listenaddress=0.0.0.0
</code></pre>
<p><strong>Ps：使得外部能访问本机端口</strong></p>
<hr>
<h1 id="五-代理设置">五、代理设置</h1>
<pre><code>cat /etc/resolv.conf|grep nameserver|awk '{print $2}'
export ALL_PROXY=&quot;http://172.24.144.1:41092&quot;

unset http_proxy
unset https_proxy
</code></pre>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="http://mofish.pily.life/post/mysql_learning_12/" class="post-title gt-a-link">
                    MySql学习之路(十二)：什么是分布式事务？
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">打工人！打工魂！我爱打工！</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/myx1002/myx1002.github.io" target="_blank">Moyuxing</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="http://mofish.pily.life/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
