<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>è®²è§£laravelæ¡†æ¶ä¸­çš„æ§åˆ¶åè½¬ï¼ˆIoCï¼‰å’Œä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ | é¸¡æ¯›è’œçš®äº‹(â—&#39;â—¡&#39;â—)</title>

<link rel="shortcut icon" href="http://mofish.pily.life/favicon.ico?v=1689146956047">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="http://mofish.pily.life/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<style>
    hr {
        margin-top: 1rem;
        margin-bottom: 1rem;
        border: 0;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <style>
    /* å¯¼èˆªæ æ ·å¼ */
    .navbar {
        position: relative;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
        -ms-flex-align: center;
        align-items: center;
        -ms-flex-pack: justify;
        justify-content: space-between;
        padding: 0.5rem 1rem;
    }

    .navbar-brand {
        display: inline-block;
        padding-top: 0.3125rem;
        padding-bottom: 0.3125rem;
        margin-right: 1rem;
        font-size: 1.25rem;
        line-height: inherit;
        white-space: nowrap;
    }

    .navbar-brand:hover,
    .navbar-brand:focus {
        text-decoration: none;
    }

    .navbar-nav {
        display: -ms-flexbox;
        display: flex;
        -ms-flex-direction: column;
        flex-direction: column;
        padding-left: 0;
        margin-bottom: 0;
        list-style: none;
    }

    .navbar-collapse {
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        -ms-flex-positive: 1;
        flex-grow: 1;
        -ms-flex-align: center;
        align-items: center;
    }

    .navbar-toggler {
        padding: 0.25rem 0.75rem;
        font-size: 1.25rem;
        line-height: 1;
        background-color: transparent;
        border: 1px solid transparent;
        border-radius: 0.25rem;
    }

    .navbar-toggler:hover,
    .navbar-toggler:focus {
        text-decoration: none;
    }

    @media (min-width: 992px) {
        .navbar-expand-lg {
            -ms-flex-flow: row nowrap;
            flex-flow: row nowrap;
            -ms-flex-pack: start;
            justify-content: flex-start;
        }

        .navbar-expand-lg .navbar-nav {
            -ms-flex-direction: row;
            flex-direction: row;
        }

        .navbar-expand-lg .navbar-collapse {
            display: -ms-flexbox !important;
            display: flex !important;
            -ms-flex-preferred-size: auto;
            flex-basis: auto;
        }

        .navbar-expand-lg .navbar-toggler {
            display: none;
        }
    }

    @media (max-width: 991px) {
        #navbarSupportedContent {
            display: none;
        }
    }
</style>
<nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="å¤´åƒ">
        <div class="site-name gt-c-content-color-first">
            é¸¡æ¯›è’œçš®äº‹(â—&#39;â—¡&#39;â—)
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    é¦–é¡µ
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    æ ‡ç­¾
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    å½’æ¡£
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    å…³äº
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1689146956047"
                action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="æœç´¢æ–‡ç« " />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* ç§»åŠ¨ç«¯å¯¼èˆªæ å±•å¼€/æ”¶èµ·åˆ‡æ¢ */
    document.getElementById('changeNavbar').onclick = function () {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>
    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    è®²è§£laravelæ¡†æ¶ä¸­çš„æ§åˆ¶åè½¬ï¼ˆIoCï¼‰å’Œä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        Â· 2022-09-02 Â·
                    </time>
                    
                        <a href="http://mofish.pily.life/tag/qo6XPqkl5/" class="post-tags">
                            # php
                        </a>
                    
                </div>
                <div class="post-content">
                    <p>ğŸ‘ ä¹‹å‰å·²ç»è®²è¿‡äº† IoC å’Œ DI çš„æ¦‚å¿µï¼Œè¿™ä¸€ç« èŠ‚è™½ç„¶ä¹Ÿæ˜¯è®²è¿™ä¸¤ä¸ªï¼Œä½†æ˜¯ä¸»è¦æ˜¯ç»“åˆ laravelæ¡†æ¶æ¥è®²è§£ï¼Œçœ‹çœ‹ laravel ä¸­çš„ IoC å’Œ DI æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p>
<!-- more -->
<h1 id="ç›®å½•">ç›®å½•</h1>
<ul>
<li><a href='#ä¸€ã€ä»€ä¹ˆæ˜¯IoC å’Œ DIï¼Ÿ'>ä¸€ã€ä»€ä¹ˆæ˜¯IoC å’Œ DIï¼Ÿ</a></li>
<li><a href='#äºŒã€ç›®çš„'>äºŒã€ç›®çš„</a></li>
<li><a href='#ä¸‰ã€åŸç”Ÿä»£ç å®ç°'>ä¸‰ã€åŸç”Ÿä»£ç å®ç°</a>
<ul>
<li><a href='#3.1 ä¼ ç»Ÿå†™æ³•'>3.1 ä¼ ç»Ÿå†™æ³•</a></li>
<li><a href='#3.2 é‡‡ç”¨IoCå’ŒDIçš„æ€æƒ³æ¥å®ç°'>3.2 é‡‡ç”¨IoCå’ŒDIçš„æ€æƒ³æ¥å®ç°</a></li>
</ul>
</li>
<li><a href='#å››ã€å¯¹ IoC å’Œ DI çš„æœ¬è´¨åˆ†æ'>å››ã€å¯¹IoCå’ŒDIçš„æœ¬è´¨åˆ†æ</a></li>
<li><a href='#äº”ã€Laravelæ¡†æ¶IoCæ ¸å¿ƒæºç '>äº”ã€Laravelæ¡†æ¶IoCæ ¸å¿ƒæºç </a>
<ul>
<li><a href='#5.1 ç»‘å®š'>5.1 ç»‘å®š</a></li>
<li><a href='#5.2 è§£æ'>5.2 è§£æ</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="a-nameä¸€-ä»€ä¹ˆæ˜¯ioc-å’Œ-diä¸€-ä»€ä¹ˆæ˜¯ioc-å’Œ-dia"><a name='ä¸€ã€ä»€ä¹ˆæ˜¯IoC å’Œ DIï¼Ÿ'>ä¸€ã€ä»€ä¹ˆæ˜¯IoC å’Œ DIï¼Ÿ</a></h1>
<h2 id="iocinversion-of-controlæ§åˆ¶åè½¬">IoCï¼ˆInversion of Controlï¼‰æ§åˆ¶åè½¬</h2>
<p>IoC æ˜¯ä¸€ä¸ªç†è®ºï¼Œä¸€ä¸ªæŒ‡å¯¼æ€æƒ³ã€‚æŒ‡å¯¼å¼€å‘äººå‘˜å¦‚ä½•ä½¿ç”¨å¯¹è±¡å»ç®¡ç†å¯¹è±¡ã€‚æŠŠå¯¹è±¡çš„åˆ›å»ºã€å±æ€§èµ‹å€¼ã€å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸéƒ½äº¤ç»™ä»£ç ä¹‹å¤–çš„å®¹å™¨ç®¡ç†ã€‚</p>
<p>IoCåˆ†ä¸º<code>æ§åˆ¶</code>å’Œ<code>åè½¬</code>ï¼š</p>
<ul>
<li>
<p>æ§åˆ¶ï¼šå¯¹è±¡åˆ›å»ºã€å±æ€§èµ‹å€¼ã€å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ã€‚</p>
</li>
<li>
<p>æ­£è½¬ï¼šå¼€å‘äººå‘˜åœ¨ä»£ç ä¸­ï¼Œä½¿ç”¨newæ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œå¼€å‘äººå‘˜æŒæ¡äº†å¯¹è±¡çš„åˆ›å»ºã€å±æ€§èµ‹å€¼ã€å¯¹è±¡ä»å¼€å§‹åˆ°é”€æ¯çš„å…¨éƒ¨è¿‡ç¨‹ï¼Œå¼€å‘äººå‘˜å¯¹å¯¹è±¡å…¨éƒ¨æ§åˆ¶ã€‚</p>
</li>
<li>
<p>åè½¬ï¼šæŠŠå¼€å‘äººå‘˜ç®¡ç†å¯¹è±¡çš„æƒé™è½¬ç§»ç»™ä»£ç ä¹‹å¤–çš„å®¹å™¨æ¥å®ç°ï¼Œç”±å®¹å™¨æ¥å®Œæˆå¯¹å¯¹è±¡çš„ç®¡ç†ã€‚</p>
</li>
</ul>
<blockquote>
<p>ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œç”±ä¸»åŠ¨ new äº§ç”Ÿå¯¹è±¡è½¬æ¢æˆä»å¤–éƒ¨æä¾›å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºæ§åˆ¶æƒç”±ç¨‹åºè½¬ç§»é“å¤–éƒ¨ã€‚</p>
</blockquote>
<br>
<h2 id="didependency-injectionä¾èµ–æ³¨å…¥">DIï¼ˆDependency Injectionï¼‰ä¾èµ–æ³¨å…¥</h2>
<p>DI æ˜¯ IoC çš„ä¸€ç§æŠ€æœ¯å®ç°ã€‚ç¨‹åºåªéœ€è¦æä¾›è¦ä½¿ç”¨çš„å¯¹è±¡åç§°å³å¯ï¼Œå¯¹è±¡å¦‚ä½•åˆ›å»ºï¼Œå¦‚ä½•ä»å®¹å™¨ä¸­æŸ¥æ‰¾ã€è·å–éƒ½ç”±å®¹å™¨å†…éƒ¨è‡ªå·±å®ç°ã€‚</p>
<br>
<h2 id="é€šä¿—è§£é‡Š">é€šä¿—è§£é‡Š</h2>
<p>å°æ˜æœ‰é’±äº†ï¼Œæƒ³è‡ªå·±å»ºä¸ªæˆ¿å­ï¼Œä½†æ˜¯è‡ªå·±å»ºçš„è¯åˆå¾ˆéº»çƒ¦å¾ˆä¹±ï¼Œäºæ˜¯å°±æ‰¾åˆ°æˆ¿äº§ä¸­ä»‹ï¼ˆIoCå®¹å™¨ï¼‰ä¹°äº†æˆ¿å­ï¼ˆDIä¾èµ–æ³¨å…¥ï¼‰ï¼Œå› æ­¤å°æ˜ä¸ç”¨è‡ªå·±å»ºï¼Œç›´æ¥æ‰¾ä¸­ä»‹å°±å¾—åˆ°äº†æƒ³è¦çš„æˆ¿å­ã€‚</p>
<p>å°æ˜<code>ä¾èµ–</code>æˆ¿å­ï¼Œä½†æ˜¯ä»–ä»è‡ªå·±ç›–æˆ¿å­ï¼ˆè‡ªå·±<code>æ§åˆ¶</code>æˆ¿å­ï¼‰åˆ°æ‰¾ä¸­ä»‹ä¹°æˆ¿å­ï¼ˆè®©ä¸­ä»‹<code>æ§åˆ¶</code>æˆ¿å­ï¼‰ï¼Œè¿™å°±å«åš<code>æ§åˆ¶åè½¬</code>ï¼Œè€Œä¸­ä»‹æ ¹æ®å°æ˜çš„è¦æ±‚ï¼Œç›´æ¥æŠŠæˆ¿å­æä¾›ç»™å°æ˜ï¼Œè¿™å°±å«åš<code>ä¾èµ–æ³¨å…¥</code>ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™ä¸ªæˆ¿å­ä¸æ˜¯ä¸­ä»‹å»ºè®¾çš„ï¼Œè€Œæ˜¯å¼€å‘å•†å»ºè®¾çš„ï¼Œè¿™ä¸ªå¼€å‘å•†å°±æ˜¯<code>æœåŠ¡æä¾›è€…</code>ï¼Œä¸­ä»‹åªæ˜¯è´Ÿè´£æŠŠæˆ¿å­æŒ‚ç‰Œå‡ºå”®ï¼Œä¾¿äºæä¾›ç»™éœ€è¦çš„äººã€‚</p>
<hr>
<h1 id="a-nameäºŒ-ç›®çš„äºŒ-ç›®çš„a"><a name='äºŒã€ç›®çš„'>äºŒã€ç›®çš„</a></h1>
<p>é‡‡ç”¨IOCæ€æƒ³å’ŒDIè®¾è®¡æ¨¡å¼ï¼Œä¸»è¦ç›®çš„æ˜¯ï¼šè§£è€¦ï¼Œç®€åŒ–ä»£ç ã€ä¾¿äºç®¡ç†ã€‚</p>
<p>ä¸ç”¨æ¯ä¸ªæ–¹æ³•é‡Œé¢éƒ½ new new new é‚£æ ·å­ï¼Œè¦ä¿®æ”¹çš„æ—¶å€™å°±éœ€è¦åˆ°å¤„æœç´¢ä¿®æ”¹ï¼Œä¸ä»…éº»çƒ¦ï¼Œè¿˜å®¹æ˜“æ”¹æ¼ã€‚</p>
<hr>
<h1 id="a-nameä¸‰-åŸç”Ÿä»£ç å®ç°ä¸‰-åŸç”Ÿä»£ç å®ç°a"><a name='ä¸‰ã€åŸç”Ÿä»£ç å®ç°'>ä¸‰ã€åŸç”Ÿä»£ç å®ç°</a></h1>
<h2 id="a-name31-ä¼ ç»Ÿå†™æ³•31-ä¼ ç»Ÿå†™æ³•a"><a name='3.1 ä¼ ç»Ÿå†™æ³•'>3.1 ä¼ ç»Ÿå†™æ³•</a></h2>
<pre><code class="language-php">&lt;?php

/**
  * è´­æˆ¿è€…
  */
class User
{
    private $userName;

    public function  __construct($userName)
    {
        $this-&gt;userName = $userName;
    }

    public function buyHouse()
    {
        $house = new House('0001', 'ä¸‰å®¤ä¸€å…', '120å¹³æ–¹ç±³');
        echo 'æˆ‘æ˜¯'.$this-&gt;userName.&quot;\r\n&quot;;
        echo 'æˆ‘ä¹°äº†'. $house-&gt;getHouseType(). 'çš„æˆ¿å­äº†'.&quot;\r\n&quot;;
        echo 'æˆ‘ä¹°äº†'. $house-&gt;getHouseArea(). 'çš„æˆ¿å­äº†'.&quot;\r\n&quot;;
    }
}

/**
  * å•†å“æˆ¿
  */
class House
{
    private $houseNo;
    private $houseType;
    private $houseArea;

    public function __construct($houseNo, $houseType, $houseArea)
    {
        $this-&gt;houseNo = $houseNo;
        $this-&gt;houseType = $houseType;
        $this-&gt;houseArea = $houseArea;
    }

    public function getHouseType()
    {
        return $this-&gt;houseType;
    }

    public function getHouseArea()
    {
        return $this-&gt;houseArea;
    }
}

$user = new User('å°æ˜');
$user-&gt;buyHouse();
&gt;
</code></pre>
<p>ä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š</p>
<pre><code>æˆ‘æ˜¯å°æ˜
æˆ‘ä¹°äº†ä¸‰å®¤ä¸€å…çš„æˆ¿å­äº†
æˆ‘ä¹°äº†120å¹³æ–¹ç±³çš„æˆ¿å­äº†
</code></pre>
<br>
<h2 id="a-name32-é‡‡ç”¨iocå’Œdiçš„æ€æƒ³æ¥å®ç°32é‡‡ç”¨iocå’Œdiçš„æ€æƒ³æ¥å®ç°a"><a name='3.2 é‡‡ç”¨IoCå’ŒDIçš„æ€æƒ³æ¥å®ç°'>3.2é‡‡ç”¨IoCå’ŒDIçš„æ€æƒ³æ¥å®ç°</a></h2>
<pre><code class="language-php">/**
 * Class è´­æˆ¿è€…
 */
class User
{
    private $userName;

    public function __construct($userName)
    {
        $this-&gt;userName = $userName;
    }

    public function buyHouse(House $house)
    {
        echo 'æˆ‘æ˜¯'.$this-&gt;userName.&quot;\r\n&quot;;
        echo 'æˆ‘ä¹°äº†'. $house-&gt;getHouseType(). 'çš„æˆ¿å­äº†'.&quot;\r\n&quot;;
        echo 'æˆ‘ä¹°äº†'. $house-&gt;getHouseArea(). 'çš„æˆ¿å­äº†'.&quot;\r\n&quot;;
    }

}


/**
  * å•†å“æˆ¿
  */
class House
{
    private $houseNo;
    private $houseType;
    private $houseArea;

    public function __construct($houseNo, $houseType, $houseArea)
    {
        $this-&gt;houseNo = $houseNo;
        $this-&gt;houseType = $houseType;
        $this-&gt;houseArea = $houseArea;
    }

    public function getHouseType()
    {
        return $this-&gt;houseType;
    }

    public function getHouseArea()
    {
        return $this-&gt;houseArea;
    }
}


/**
 * æˆ¿äº§ä¸­ä»‹ï¼Œå°±æ˜¯æˆ‘ä»¬è®²çš„ioc
 * Class æˆ¿äº§ä¸­ä»‹
 */
class æˆ¿äº§ä¸­ä»‹
{
    private $åœ¨å”®æˆ¿æº = [];//è¿™ä¸ªç±»ä¼¼äºlaravelçš„Containerå¯¹è±¡ä¸­çš„$bindings
    private $è®¤ç­¹æˆ¿æº = [];//ç±»ä¼¼äºlaravelçš„Containerå¯¹è±¡ä¸­çš„$resolved
    private $å…¬ç§Ÿæˆ¿ = [];//ç±»ä¼¼äºlaravelçš„Containerå¯¹è±¡ä¸­çš„$instances
    private $ç½‘çº¢æˆ¿æº = [];//ç±»ä¼¼äºlaravelçš„Containerå¯¹è±¡ä¸­çš„$aliases / $abstractAliases
    private $æ„å‘è´­æˆ¿ç¾¤ä½“ = [];

    public function é¢„å”®ç™»è®°($æˆ·å‹, $è¯¦ç»†ä¿¡æ¯)
    {
        $this-&gt;åœ¨å”®æˆ¿æº[$æˆ·å‹] = $è¯¦ç»†ä¿¡æ¯;
    }

    public function è·å–åœ¨å”®æˆ¿æº($æˆ·å‹)
    {
        return ($this-&gt;åœ¨å”®æˆ¿æº[$æˆ·å‹])();//å› ä¸ºæ˜¯é—­åŒ…ï¼Œæ‰€ä»¥ï¼Œè¦å¢åŠ ()æ¥æ‰§è¡Œé—­åŒ…å‡½æ•°
    }

    public function æ„å‘ç™»è®°($æ„å‘äºº, $ä¸ªäººä¿¡æ¯)
    {
        $this-&gt;æ„å‘è´­æˆ¿ç¾¤ä½“[$æ„å‘äºº] = $ä¸ªäººä¿¡æ¯;
    }

    public function è·å–æ„å‘äººä¿¡æ¯($æ„å‘äºº)
    {
        return ($this-&gt;æ„å‘è´­æˆ¿ç¾¤ä½“[$æ„å‘äºº])();//å› ä¸ºæ˜¯é—­åŒ…ï¼Œæ‰€ä»¥ï¼Œè¦å¢åŠ ()æ¥æ‰§è¡Œé—­åŒ…å‡½æ•°
    }
}

$app = new æˆ¿äº§ä¸­ä»‹();
$app-&gt;é¢„å”®ç™»è®°('ä¸‰å®¤ä¸€å…', function(){
    return new House('1001', 'ä¸‰å®¤ä¸€å…', '100å¹³æ–¹ç±³');
});
$app-&gt;é¢„å”®ç™»è®°('å››å®¤ä¸¤å…', function(){
    return new House('1002', 'å››å®¤ä¸¤å…', '150å¹³æ–¹ç±³');
});

$app-&gt;æ„å‘ç™»è®°('å°æ˜', function(){
    return new User('å°æ˜');
});

$app-&gt;æ„å‘ç™»è®°('å¼ ä¸‰', function(){
    return new User('å¼ ä¸‰');
});

//echo $app-&gt;è·å–æ„å‘äººä¿¡æ¯('å°æ˜')-&gt;ä¹°æˆ¿($app-&gt;è·å–åœ¨å”®æˆ¿æº('å››å®¤ä¸¤å…'));

$user = $app-&gt;è·å–æ„å‘äººä¿¡æ¯('å°æ˜');
$house = $app-&gt;è·å–åœ¨å”®æˆ¿æº('å››å®¤ä¸¤å…');
$user-&gt;buyHouse($house);
</code></pre>
<p>ä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š</p>
<pre><code>æˆ‘æ˜¯å°æ˜
æˆ‘ä¹°äº†ä¸‰å®¤ä¸€å…çš„æˆ¿å­äº†
æˆ‘ä¹°äº†120å¹³æ–¹ç±³çš„æˆ¿å­äº†
</code></pre>
<hr>
<h1 id="a-nameå››-å¯¹-ioc-å’Œ-di-çš„æœ¬è´¨åˆ†æå››-å¯¹iocå’Œdiçš„æœ¬è´¨åˆ†æa"><a name='å››ã€å¯¹ IoC å’Œ DI çš„æœ¬è´¨åˆ†æ'>å››ã€å¯¹IoCå’ŒDIçš„æœ¬è´¨åˆ†æ</a></h1>
<p>ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ¿äº§ä¸­ä»‹ä½œä¸ºIoCï¼Œå…¶å®æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆä¸€ç»´æˆ–è€…å¤šç»´ï¼‰ã€‚</p>
<p>å…¶å®ï¼Œåœ¨laravelæ¡†æ¶ä¸­ï¼Œ<code>Container</code>å¯¹è±¡ä¸­çš„å±æ€§<code>$bindings</code> ã€<code>$resolved</code> ã€<code>$instances</code> ã€<code>$aliases</code>ã€<code>$abstractAliases</code> å…¶å®ä¹Ÿæ˜¯ä»ä¸åŒç»´åº¦æ¥ç®¡ç†æ³¨å†Œåˆ°å®¹å™¨ä¸­çš„å¯¹è±¡çš„ã€‚</p>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœä»ä¸šåŠ¡é€»è¾‘è§’åº¦æ¥è®²ï¼Œæ— éå°±æ˜¯è´­æˆ¿è€…ä¹°æˆ¿ï¼Œä¸»è¦çš„ç±»æœ‰ï¼šè´­æˆ¿è€…ã€å•†å“æˆ¿ã€‚å¦‚æœæŒ‰ç…§ä¼ ç»Ÿä»£ç æ¥å®ç°çš„è¯ï¼Œé‚£ä¹ˆè´­æˆ¿è€…å¯¹è±¡å¯¹å•†å“æˆ¿å¯¹è±¡çš„ä¾èµ–æ˜¯<strong>å¼ºä¾èµ–</strong>ï¼Œå› ä¸ºåœ¨è´­æˆ¿è€…ç±»ä¸­éœ€è¦new å•†å“æˆ¿ç±»()ã€‚</p>
<p>è€Œå¦‚æœé‡‡ç”¨ IoCå’ŒDI çš„æ€æƒ³æ¥å®ç°çš„è¯ï¼Œå¢åŠ äº†æˆ¿äº§ä¸­ä»‹è¿™ä¸ª<code> IoC å®¹å™¨</code>ï¼Œ<strong>å•†å“æˆ¿</strong>é¦–å…ˆåœ¨<strong>æˆ¿äº§ä¸­ä»‹</strong>é‚£è¾¹è¿›è¡Œä¸€ä¸‹<strong>é¢„å”®ç™»è®°</strong>ï¼Œ<strong>è´­æˆ¿è€…</strong>ä¹Ÿåœ¨<strong>æˆ¿äº§ä¸­ä»‹</strong>é‚£è¾¹è¿›è¡Œä¸€ä¸‹<strong>æ„å‘ç™»è®°</strong>ï¼Œè´­æˆ¿è€…å¯¹è±¡éœ€è¦ä¾èµ–å•†å“æˆ¿å¯¹è±¡ï¼Œé‡‡ç”¨<code>ä¾èµ–æ³¨å…¥</code>ã€‚</p>
<p>å³ï¼šè®©æˆ¿äº§ä¸­ä»‹ç›´æ¥æŠŠå®ä¾‹åŒ–ååˆ°å•†å“æˆ¿å¯¹è±¡æ³¨å…¥åˆ°è´­æˆ¿è€…å¯¹è±¡ï¼Œè´­æˆ¿è€…å¯¹è±¡æ— éœ€å…³æ³¨æ€ä¹ˆå®ä¾‹åŒ–ï¼Œåªç®¡æ‹¿è¿‡æ¥ç”¨å°±è¡Œã€‚</p>
<hr>
<h1 id="a-nameäº”-laravelæ¡†æ¶iocæ ¸å¿ƒæºç äº”-laravelæ¡†æ¶iocæ ¸å¿ƒæºç a"><a name='äº”ã€Laravelæ¡†æ¶IoCæ ¸å¿ƒæºç '>äº”ã€Laravelæ¡†æ¶IoCæ ¸å¿ƒæºç </a></h1>
<h2 id="a-name51-ç»‘å®š51-ç»‘å®ša"><a name='5.1 ç»‘å®š'>5.1 ç»‘å®š</a></h2>
<p>æˆ‘ä»¬æ¥ç®€å•çœ‹ä¸‹laravelæ¡†æ¶çš„æ ¸å¿ƒå®¹å™¨çš„ç»‘å®šæ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä»¥åŠä¸‰ç§ç»‘å®šæ¨¡å¼çš„åŒºåˆ«ã€‚</p>
<p>ä»¥ä¸‹ä»£ç éƒ½æ˜¯åœ¨Illuminate\Container\Containerç±»ä¸­</p>
<h2 id="bindç»‘å®š">bindç»‘å®š</h2>
<pre><code class="language-php">      /**
       * Register a binding with the container.
       *
       * @param  string  $abstract
       * @param  \Closure|string|null  $concrete
       * @param  bool  $shared
       * @return void
       */
      public function bind($abstract, $concrete = null, $shared = false)
      {
          //ç§»é™¤æ—§çš„å®ä¾‹
          $this-&gt;dropStaleInstances($abstract);
  
          // If no concrete type was given, we will simply set the concrete type to the
          // abstract type. After that, the concrete type to be registered as shared
          // without being forced to state their classes in both of the parameters.
          if (is_null($concrete)) {
              $concrete = $abstract;
          }
  
          // If the factory is not a Closure, it means it is just a class name which is
          // bound into this container to the abstract type and we will just wrap it
          // up inside its own Closure to give us more convenience when extending.
          if (! $concrete instanceof Closure) {
              $concrete = $this-&gt;getClosure($abstract, $concrete);
          }
  
        // åˆ›å»ºä¸€ä¸ªåŒ…å«å˜é‡ä¸å…¶å€¼çš„æ•°ç»„ã€‚
        //å¯¹æ¯ä¸ªå‚æ•°ï¼Œcompact() åœ¨å½“å‰çš„ç¬¦å·è¡¨ä¸­æŸ¥æ‰¾è¯¥å˜é‡åå¹¶å°†å®ƒæ·»åŠ åˆ°è¾“å‡ºçš„æ•°ç»„ä¸­ï¼Œå˜é‡åæˆä¸ºé”®åè€Œå˜é‡çš„å†…å®¹æˆä¸ºè¯¥é”®çš„å€¼ã€‚ç®€å•è¯´ï¼Œå®ƒåšçš„äº‹å’Œ extract() æ­£å¥½ç›¸åã€‚è¿”å›å°†æ‰€æœ‰å˜é‡æ·»åŠ è¿›å»åçš„æ•°ç»„ã€‚
          $this-&gt;bindings[$abstract] = compact('concrete', 'shared');
  
          // If the abstract type was already resolved in this container we'll fire the
          // rebound listener so that any objects which have already gotten resolved
          // can have their copy of the object updated via the listener callbacks.
          //æ£€æŸ¥æ˜¯å¦è§£æè¿‡ æˆ–åˆ™ å·²ç»å­˜åœ¨æ‰€è¦ç»‘å®šå¯¹è±¡å¯¹åº”çš„å®ä¾‹
          if ($this-&gt;resolved($abstract)) {
              $this-&gt;rebound($abstract);
          }
      }
</code></pre>
<p>å¦‚ä½•ä½¿ç”¨bindæ–¹æ³•æ¥å°†å¯¹è±¡æ³¨å†Œç»‘å®šåˆ°å®¹å™¨ä¸­å‘¢ï¼Ÿå¦‚ä¸‹ï¼Œbindæ–¹æ³•æ˜¯å°†é—­åŒ…ç»‘å®šåˆ°å®¹å™¨å½“ä¸­</p>
<pre><code class="language-php">$this-&gt;app-&gt;bind('User\API', function ($app) {
  		return new User\API($app-&gt;make('UserLogin'));
  });
</code></pre>
<blockquote>
<p>åŒæ ·ï¼Œbindæ–¹æ³•ä¼šå…ˆåˆ é™¤æ—§çš„å®ä¾‹ï¼Œç„¶åå†æ–°çš„å®ä¾‹æ”¾å…¥é—­åŒ…ä¸­ï¼Œå†ç»‘å®šåˆ°å®¹å™¨ä¸­ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸æ˜¯é—­åŒ…ï¼Œä¼šé€šè¿‡getClosureæ–¹æ³•å°†ç±»åå°è£…åˆ°é—­åŒ…ä¸­ï¼Œç„¶ååœ¨é—­åŒ…ä¸­é€šè¿‡makeæ–¹æ³•æˆ–buildæ–¹æ³•è§£æç»‘å®šçš„ç±»ã€‚ç»‘å®šæ—¶ä¼šå°†é—­åŒ…å’Œæ˜¯å¦æ˜¯sharedæ”¾å…¥$this-&gt;bind[]æ•°ç»„ä¸­ï¼Œè§£ææ—¶è°ƒç”¨ã€‚</p>
</blockquote>
<br>
<h3 id="singletonç»‘å®š">singletonç»‘å®š</h3>
<pre><code class="language-php">/**
 * Register a shared binding in the container.
 *  ç»‘å®šåˆ°å®¹å™¨çš„å¯¹è±¡åªä¼šè¢«è§£æä¸€æ¬¡ï¼Œä¹‹åçš„è°ƒç”¨éƒ½è¿”å›ç›¸åŒçš„å®ä¾‹ï¼š
 * @param  string|array  $abstract
 * @param  \Closure|string|null  $concrete
 * @return void
 */
public function singleton($abstract, $concrete = null)
{
    $this-&gt;bind($abstract, $concrete, true);
}
</code></pre>
<blockquote>
<p>ä»å®˜æ–¹çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œsingletonæ–¹æ³•ï¼Œæœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº†$this-&gt;bind()æ–¹æ³•ï¼Œåªæ˜¯é€šè¿‡singleton()æ–¹æ³•ç»‘å®šåˆ°å®¹å™¨çš„å¯¹è±¡åªä¼šè¢«è§£æä¸€æ¬¡ï¼Œä¹‹åçš„è°ƒç”¨éƒ½è¿”å›ç›¸åŒçš„å®ä¾‹ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„å•ä¾‹ã€‚</p>
</blockquote>
<br>
<h3 id="instanceç»‘å®š">instanceç»‘å®š</h3>
<pre><code class="language-php">       /**
        * Register an existing instance as shared in the container.
        *
        * @param  string  $abstract
        * @param  mixed   $instance
        * @return mixed
        */
       public function instance($abstract, $instance)
       {
           //ç§»é™¤å·²ç»å­˜åœ¨çš„æŠ½è±¡çš„åˆ«å
           $this-&gt;removeAbstractAlias($abstract);
   
           //æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨è¯¥åˆ«åçš„ç»‘å®šçš„å¯¹è±¡
           $isBound = $this-&gt;bound($abstract);
   
           unset($this-&gt;aliases[$abstract]);
   
           // We'll check to determine if this type has been bound before, and if it has
           // we will fire the rebound callbacks registered with the container and it
           // can be updated with consuming classes that have gotten resolved here.
           $this-&gt;instances[$abstract] = $instance;
   
           // åˆ¤æ–­æ˜¯å¦å·²ç»ç»‘å®š
           if ($isBound) {
               $this-&gt;rebound($abstract);
           }
   
           return $instance;
       }
</code></pre>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°åœ¨instanceæ–¹æ³•ä¸­ï¼Œé¦–å…ˆç§»é™¤å·²ç»å­˜åœ¨çš„ç›¸åŒçš„åˆ«åï¼Œç„¶åå°†å¯¹è±¡å­˜å…¥$this-&gt;instance æ•°ç»„ä¸­ã€‚ç„¶åå®Œæˆäº†ç»‘å®šã€‚</p>
<p>ä½¿ç”¨è¯¥æ–¹æ³•æ³¨å†Œç»‘å®šåˆ°å®¹å™¨ä¸­çš„å¯¹è±¡å®ä¾‹æ˜¯å…±äº«çš„ã€‚</p>
</blockquote>
<br>
<h3 id="ç»“è®º">ç»“è®º</h3>
<blockquote>
<p>bindï¼šä¸æå‰å ç”¨å†…å­˜, å¾…åˆ°è°ƒç”¨çš„æ—¶å€™è°ƒç”¨æ‰ä¼šè¿›è¡Œå®ä¾‹åŒ–, æ¯æ¬¡éƒ½newä¸€ä¸ªæ–°å®ä¾‹ã€‚</p>
<p>singletionï¼šéœ€è¦æå‰å ç”¨å†…å­˜, ä¹Ÿå°±æ˜¯éœ€è¦å…ˆæå‰å®ä¾‹åŒ–å‡ºä¸€ä¸ªå¯¹è±¡, ä¹‹åçš„æ¯æ¬¡è°ƒç”¨éƒ½æ˜¯è°ƒç”¨è¿™ä¸ªå®ä¾‹ã€‚</p>
<p>instanceï¼šä¸æå‰å ç”¨å†…å­˜, å¾…åˆ°è°ƒç”¨çš„æ—¶å€™, å¾…åˆ°è°ƒç”¨çš„æ—¶å€™è°ƒç”¨æ‰ä¼šè¿›è¡Œå®ä¾‹åŒ–, æ¯æ¬¡è¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚</p>
</blockquote>
<br>
<h2 id="a-name52-è§£æ52-è§£æa"><a name='5.2 è§£æ'>5.2 è§£æ</a></h2>
<pre><code class="language-php">    /**
     * Resolve the given type from the container.
     *
     * @param  string  $abstract
     * @param  array  $parameters
     * @return mixed
     *
     * @throws \Illuminate\Contracts\Container\BindingResolutionException
     */
    public function make($abstract, array $parameters = [])
    {
        return $this-&gt;resolve($abstract, $parameters);
    }


    /**
     * Resolve the given type from the container.
     *
     * @param  string  $abstract
     * @param  array  $parameters
     * @param  bool   $raiseEvents
     * @return mixed
     *
     * @throws \Illuminate\Contracts\Container\BindingResolutionException
     */
    protected function resolve($abstract, $parameters = [], $raiseEvents = true)
    {
        $abstract = $this-&gt;getAlias($abstract);

        $needsContextualBuild = ! empty($parameters) || ! is_null(
            $this-&gt;getContextualConcrete($abstract)
        );

        // If an instance of the type is currently being managed as a singleton we'll
        // just return an existing instance instead of instantiating new instances
        // so the developer can keep using the same objects instance every time.
        if (isset($this-&gt;instances[$abstract]) &amp;&amp; ! $needsContextualBuild) {
            return $this-&gt;instances[$abstract];
        }

        $this-&gt;with[] = $parameters;

        $concrete = $this-&gt;getConcrete($abstract);

        // We're ready to instantiate an instance of the concrete type registered for
        // the binding. This will instantiate the types, as well as resolve any of
        // its &quot;nested&quot; dependencies recursively until all have gotten resolved.
        if ($this-&gt;isBuildable($concrete, $abstract)) {
            $object = $this-&gt;build($concrete);
        } else {
            $object = $this-&gt;make($concrete);
        }

        // If we defined any extenders for this type, we'll need to spin through them
        // and apply them to the object being built. This allows for the extension
        // of services, such as changing configuration or decorating the object.
        foreach ($this-&gt;getExtenders($abstract) as $extender) {
            $object = $extender($object, $this);
        }

        // If the requested type is registered as a singleton we'll want to cache off
        // the instances in &quot;memory&quot; so we can return it later without creating an
        // entirely new instance of an object on each subsequent request for it.
        if ($this-&gt;isShared($abstract) &amp;&amp; ! $needsContextualBuild) {
            $this-&gt;instances[$abstract] = $object;
        }

        if ($raiseEvents) {
            $this-&gt;fireResolvingCallbacks($abstract, $object);
        }

        // Before returning, we will also set the resolved flag to &quot;true&quot; and pop off
        // the parameter overrides for this build. After those two things are done
        // we will be ready to return back the fully constructed class instance.
        $this-&gt;resolved[$abstract] = true;

        array_pop($this-&gt;with);

        return $object;
    }


    /**
     * Instantiate a concrete instance of the given type.
     *
     * @param  string  $concrete
     * @return mixed
     *
     * @throws \Illuminate\Contracts\Container\BindingResolutionException
     */
    public function build($concrete)
    {
        // If the concrete type is actually a Closure, we will just execute it and
        // hand back the results of the functions, which allows functions to be
        // used as resolvers for more fine-tuned resolution of these objects.
        if ($concrete instanceof Closure) {
            return $concrete($this, $this-&gt;getLastParameterOverride());
        }

        try {
            $reflector = new ReflectionClass($concrete);
        } catch (ReflectionException $e) {
            throw new BindingResolutionException(&quot;Target class [$concrete] does not exist.&quot;, 0, $e);
        }

        // If the type is not instantiable, the developer is attempting to resolve
        // an abstract type such as an Interface or Abstract Class and there is
        // no binding registered for the abstractions so we need to bail out.
        if (! $reflector-&gt;isInstantiable()) {
            return $this-&gt;notInstantiable($concrete);
        }

        $this-&gt;buildStack[] = $concrete;

        $constructor = $reflector-&gt;getConstructor();

        // If there are no constructors, that means there are no dependencies then
        // we can just resolve the instances of the objects right away, without
        // resolving any other types or dependencies out of these containers.
        if (is_null($constructor)) {
            array_pop($this-&gt;buildStack);

            return new $concrete;
        }

        $dependencies = $constructor-&gt;getParameters();

        // Once we have all the constructor's parameters we can create each of the
        // dependency instances and then use the reflection instances to make a
        // new instance of this class, injecting the created dependencies in.
        try {
            $instances = $this-&gt;resolveDependencies($dependencies);
        } catch (BindingResolutionException $e) {
            array_pop($this-&gt;buildStack);

            throw $e;
        }

        array_pop($this-&gt;buildStack);

        return $reflector-&gt;newInstanceArgs($instances);
    }
</code></pre>
<p>ä»ä¸Šé¢çš„ç¬¬ä¸‰æ®µä»£ç build()æ–¹æ³•ä¸­å¯ä»¥çœ‹å‡ºï¼Œè§£ææ—¶ï¼Œå¦‚æœç»‘å®šæ³¨å†Œçš„æ˜¯é—­åŒ…å‡½æ•°ï¼Œé‚£ä¹ˆå°±æ˜¯ç›´æ¥è¿”å›é—­åŒ…å‡½æ•°çš„æ‰§è¡Œï¼Œå…³é”®ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-php">if ($concrete instanceof Closure) {
            return $concrete($this, $this-&gt;getLastParameterOverride());
}
</code></pre>
<p>å¦‚æœç»‘å®šæ³¨å†Œçš„æ˜¯ç±»åï¼Œé‚£ä¹ˆå°±åˆ©ç”¨phpçš„åå°„ï¼ˆReflectionClassï¼‰æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶è¿”å›ç»™è°ƒç”¨è€…ã€‚bind()æ–¹æ³•å‰©ä¸‹çš„ä»£ç å¹²çš„å°±æ˜¯è¿™ä¸ªå·¥ä½œã€‚</p>
<p>æœ€åï¼Œåœ¨resolve()æ–¹æ³•ä¸­çš„</p>
<pre><code class="language-php">$this-&gt;resolved[$abstract] = true;
</code></pre>
<p>ä»£è¡¨å·²ç»è§£ææˆåŠŸäº†ã€‚</p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">ä¸‹ä¸€ç¯‡</div>
                <a href="http://mofish.pily.life/post/jiang-jiang-aop-yu-oop-you-shi-me-qu-bie/" class="post-title gt-a-link">
                    è®²è®²AOPä¸OOPæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿï¼ˆå·²è¿ç§»ï¼‰
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">æ‰“å·¥äººï¼æ‰“å·¥é­‚ï¼æˆ‘çˆ±æ‰“å·¥ï¼</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/myx1002/myx1002.github.io" target="_blank">Moyuxing</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="http://mofish.pily.life/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
