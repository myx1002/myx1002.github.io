<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Rediså­¦ä¹ ä¹‹è·¯(ä¸‰)ï¼šé™æµä¹‹Redis-Cell | é¸¡æ¯›è’œçš®äº‹(â—&#39;â—¡&#39;â—)</title>

<link rel="shortcut icon" href="http://mofish.pily.life/favicon.ico?v=1689146956047">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="http://mofish.pily.life/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<style>
    hr {
        margin-top: 1rem;
        margin-bottom: 1rem;
        border: 0;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <style>
    /* å¯¼èˆªæ æ ·å¼ */
    .navbar {
        position: relative;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
        -ms-flex-align: center;
        align-items: center;
        -ms-flex-pack: justify;
        justify-content: space-between;
        padding: 0.5rem 1rem;
    }

    .navbar-brand {
        display: inline-block;
        padding-top: 0.3125rem;
        padding-bottom: 0.3125rem;
        margin-right: 1rem;
        font-size: 1.25rem;
        line-height: inherit;
        white-space: nowrap;
    }

    .navbar-brand:hover,
    .navbar-brand:focus {
        text-decoration: none;
    }

    .navbar-nav {
        display: -ms-flexbox;
        display: flex;
        -ms-flex-direction: column;
        flex-direction: column;
        padding-left: 0;
        margin-bottom: 0;
        list-style: none;
    }

    .navbar-collapse {
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        -ms-flex-positive: 1;
        flex-grow: 1;
        -ms-flex-align: center;
        align-items: center;
    }

    .navbar-toggler {
        padding: 0.25rem 0.75rem;
        font-size: 1.25rem;
        line-height: 1;
        background-color: transparent;
        border: 1px solid transparent;
        border-radius: 0.25rem;
    }

    .navbar-toggler:hover,
    .navbar-toggler:focus {
        text-decoration: none;
    }

    @media (min-width: 992px) {
        .navbar-expand-lg {
            -ms-flex-flow: row nowrap;
            flex-flow: row nowrap;
            -ms-flex-pack: start;
            justify-content: flex-start;
        }

        .navbar-expand-lg .navbar-nav {
            -ms-flex-direction: row;
            flex-direction: row;
        }

        .navbar-expand-lg .navbar-collapse {
            display: -ms-flexbox !important;
            display: flex !important;
            -ms-flex-preferred-size: auto;
            flex-basis: auto;
        }

        .navbar-expand-lg .navbar-toggler {
            display: none;
        }
    }

    @media (max-width: 991px) {
        #navbarSupportedContent {
            display: none;
        }
    }
</style>
<nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="å¤´åƒ">
        <div class="site-name gt-c-content-color-first">
            é¸¡æ¯›è’œçš®äº‹(â—&#39;â—¡&#39;â—)
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    é¦–é¡µ
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    æ ‡ç­¾
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    å½’æ¡£
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    å…³äº
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1689146956047"
                action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="æœç´¢æ–‡ç« " />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* ç§»åŠ¨ç«¯å¯¼èˆªæ å±•å¼€/æ”¶èµ·åˆ‡æ¢ */
    document.getElementById('changeNavbar').onclick = function () {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>
    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    Rediså­¦ä¹ ä¹‹è·¯(ä¸‰)ï¼šé™æµä¹‹Redis-Cell
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        Â· 2021-05-13 Â·
                    </time>
                    
                        <a href="http://mofish.pily.life/tag/P-RRy8DydH/" class="post-tags">
                            # redis
                        </a>
                    
                </div>
                <div class="post-content">
                    <p>é™æµç®—æ³•åœ¨åˆ†å¸ƒå¼é¢†åŸŸæ˜¯ä¸€ä¸ªç»å¸¸è¢«æèµ·çš„è¯é¢˜ ï¼Œå½“ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›æœ‰é™æ—¶ğŸ’¢ï¼Œæˆ–è€…å½“æ´»åŠ¨ç«çƒ­è®¿é—®é‡çªç„¶éª¤å¢æ—¶ğŸ“ˆğŸ“ˆ<br>
å¦‚ä½•é˜»æ­¢è®¡åˆ’å¤–çš„è¯·æ±‚ç»§ç»­å¯¹ç³»ç»Ÿæ–½å‹ï¼Œè¿™æ—¶ä¸€ä¸ªéœ€è¦é‡è§†çš„é—®é¢˜ğŸ¤ </p>
<!-- more -->
<p>é™¤äº†ä¸Šé¢æ‰€è¯´çš„æƒ…å†µï¼Œé™æµè¿˜æœ‰ä¸€ä¸ªåŒæ ·å¸¸ç”¨çš„åœºæ™¯ï¼Œé‚£å°±æ˜¯æœ‰ç›®çš„çš„æ§åˆ¶ç”¨æˆ·è¡Œä¸ºï¼Œé¿å…åƒåœ¾è¯·æ±‚ï¼Œä¾‹å¦‚ç”¨æˆ·æ¶æ„åˆ·æ¥å£ã€ä¾‹å¦‚æ¯æ—¥é™åˆ¶å‘å¸–æ•°é‡ç­‰ç­‰ã€‚</p>
<h2 id="ä¸€-ç®€å•é™æµç­–ç•¥">ä¸€ã€ç®€å•é™æµç­–ç•¥</h2>
<p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¸¸è§çš„ã€ç®€å•çš„é™æµç­–ç•¥ã€‚ç³»ç»Ÿé™å®šç”¨æˆ·æŸä¸ªè¡Œä¸ºåœ¨æŒ‡å®šæ—¶é—´é‡Œåªèƒ½å‘ç”ŸNæ¬¡ï¼Œé‚£ä¹ˆå¦‚ä½•ä½¿ç”¨Redisçš„æ•°æ®ç»“æ„æ¥å®ç°è¿™ä¸ªç®€å•çš„é™æµåŠŸèƒ½å‘¢ï¼Ÿ</p>
<h3 id="aè¿‡æœŸæ—¶é—´å†…è‡ªå¢">a.è¿‡æœŸæ—¶é—´å†…è‡ªå¢</h3>
<p>åŸç†ï¼šè¯¥æ–¹æ³•æ˜¯åˆ©ç”¨Redisçš„Incrè‡ªå¢å‘½ä»¤å’ŒExpireå‘½ä»¤ï¼Œä»ç¬¬ä¸€æ¬¡è¯·æ±‚å¼€å§‹è®¡ç®—ï¼Œå¦‚æœåœ¨èŒƒå›´æ—¶é—´å†…ï¼ŒIncræ¬¡æ•°è¾¾åˆ°æœ€å¤§é™åˆ¶æ¬¡æ•°çš„è¯ğŸ“ˆğŸ“ˆï¼Œåˆ™é™åˆ¶ğŸˆ²æœ¬æ¬¡æ“ä½œã€‚</p>
<h4 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹</h4>
<pre><code class="language-php">&lt;?php

class ActionLimit {
    private $redis;

    public function __construct()
    {
        // è¿æ¥Redis
        $redis = new Redis();
        $redis-&gt;connect('127.0.0.1', '6379');
        $redis-&gt;auth('xxxxxx');
        $this-&gt;redis = $redis;
    }

    /**
     * æ£€æŸ¥
     * @param $userId(ç”¨æˆ·IDï¼Œå”¯ä¸€æ ‡è¯†)
     * @param $action(è¯·æ±‚è¡¨ç¤º)
     * @param $period(è§„å®šæ—¶é—´å†…,åˆ†é’Ÿ)
     * @param $maxCount(æœ€å¤§è¯·æ±‚æ¬¡æ•°)
     * @return bool
     */
    public function checkActionLimit($userId, $action, $period, $maxCount)
    {
        $key = 'hits:' . $userId . ':' . $action;

        // è®¿é—®æ¬¡æ•°è‡ªå¢ä¸€
        $hitCount = $this-&gt;redis-&gt;incr($key);

        if ($hitCount == 1) {
            $this-&gt;redis-&gt;expire($key, $period * 60);
        }

        echo &quot;hits:&quot; . $hitCount . PHP_EOL;
        if ($hitCount &gt; $maxCount) {
            return false;
        }
        return true;
    }
}


$actionLimit = new ActionLimit();
for ($i = 1; $i &lt; 10; $i++) {
    sleep(2);  // ç¡å®ƒä¸¤ç§’
    // ä¸€åˆ†é’Ÿæœ€å¤šåªèƒ½è¯„è®º5æ¬¡
    $str =  date('Y-m-d H:i:s') . &quot; : ç¬¬{$i}æ¬¡è®¿é—® &quot; ;
    $checkLimit  = $actionLimit-&gt;checkActionLimit(10086, 'addComment', 1, 5);
    if (!$checkLimit) {
        $str .= 'è¶…è¿‡é™åˆ¶äº†';
    }
    echo $str  . PHP_EOL;
}
</code></pre>
<p>æ‰§è¡Œç»“æœï¼š<br>
<img src="http://mofish.pily.life/post-images/1621002196430.jpg" alt="" loading="lazy"></p>
<!-- more -->
<h3 id="bæ»‘åŠ¨æ—¶é—´çª—å£">b.æ»‘åŠ¨æ—¶é—´çª—å£</h3>
<p>é™¤äº†ä¸Šé¢è¿™ä¸ªç®€å•çš„æ–¹æ³•ï¼Œåœ¨ä¹¦ä¸­è¿˜çœ‹åˆ°è¿‡ä¸€ä¸ªæ»‘åŠ¨äº‹ä»¶çª—å£ï¼ˆå®šå®½ï¼‰çš„æ–¹æ¡ˆï¼Œå°±æ˜¯ä½¿ç”¨ZSetæ•°æ®ç»“æ„çš„Scoreå€¼ï¼Œé€šè¿‡Scoreå€¼åœˆå‡ºè¿™ä¸ªæ—¶é—´çª—å£ï¼Œ</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿ç•™è¯¥çª—å£å†…çš„æ•°æ®ï¼Œçª—å£å¤–çš„æ•°æ®éƒ½å¯ä»¥ç æ‰æˆ–è€…é™åˆ¶é¢å¤–çš„æ•°æ®è¿›å…¥çª—å£ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”¨ä¸€ä¸ªZSetç»“æ„è®°å½•ç”¨æˆ·çš„è¡Œä¸ºå†å²ï¼Œæ¯ä¸€ä¸ªè¡Œä¸ºéƒ½ä¼šä½œä¸ºZSetä¸­çš„ä¸€ä¸ªKeyä¿å­˜ä¸‹æ¥ï¼ŒåŒä¸€ä¸ªç”¨æˆ·çš„åŒä¸€ç§è¡Œä¸ºç”¨ä¸€ä¸ªZSetè®°å½•ã€‚</p>
<figure data-type="image" tabindex="1"><img src="http://mofish.pily.life/post-images/1626792680168.png" alt="" loading="lazy"></figure>
<h4 id="ä»£ç ç¤ºä¾‹-2">ä»£ç ç¤ºä¾‹</h4>
<pre><code class="language-php">&lt;?php

class Period
{
    private $redis;

    public function __construct()
    {
        $redis = new Redis();
        $redis-&gt;connect('127.0.0.1', 6379);
        $redis-&gt;auth('111111');
        $this-&gt;redis = $redis;
    }

    public function checkIsUsing($userId, $actionKey, $period, $maxCount)
    {
        $key = &quot;hist:{$userId}-{$actionKey}&quot;;
        $nowTime = time();

        // ç§»é™¤æ»‘åŠ¨çª—å£å†…å¤šä½™çš„æ•°æ®
        $this-&gt;redis-&gt;zRemRangeByScore($key, 0, $nowTime - $period);

        // è·å–å½“å‰çª—å£å†…æ´»åŠ¨çš„æ•°æ®æ•°é‡
        $currentCount = $this-&gt;redis-&gt;zCard($key);

        // è·å–å½“å‰çª—å£å†…æœ€æ—©è¦è¿‡æœŸçš„ä¸€æ¡æ•°æ®
        $minActionTime = $this-&gt;redis-&gt;zRange($key, -$maxCount, -$maxCount);

        if ($currentCount &gt;= $maxCount) {
            // å¦‚æœå½“å‰çª—å£æ•°æ®è¶…è¿‡maxCountï¼Œåˆ™è¿”å›é”™è¯¯æç¤º
            $waitTime = $minActionTime[0] + $period - time();
            echo &quot;{$period}ç§’å†…æœ€å¤šæ“ä½œ{$maxCount}æ¬¡ï¼Œè¯·ç­‰å¾…{$waitTime}ç§’&quot;.PHP_EOL;
            return false;
        }else {
            // å¦‚æœå½“å‰çª—å£æ•°æ®æ²¡æœ‰è¶…è¿‡maxCountï¼Œåˆ™æ’å…¥æ•°æ®
            $this-&gt;redis-&gt;zAdd($key,$nowTime, $nowTime);
            // åŠ ä¸ªè¿‡æœŸæ—¶é—´ï¼Œé¿å…å†·æ•°æ®æŒç»­å ç”¨å†…å­˜
            $this-&gt;redis-&gt;expire($key, $period + 1);
            return true;
        }
    }
}

$period = new Period();
// 60ç§’å†…åªèƒ½å‘è¡¨5æ¬¡è¯„è®º
if ($period-&gt;checkIsUsing(10086, 'addComment', 60, 5)) {
    echo 'è¯„è®ºæˆåŠŸ' . PHP_EOL;
}
</code></pre>
<p>æ‰§è¡Œç»“æœï¼š<br>
<img src="http://mofish.pily.life/post-images/1626793870869.PNG" alt="" loading="lazy"></p>
<!-- more -->
<h2 id="äºŒ-é«˜çº§é™æµç®—æ³•-æ¼æ–—é™æµ">äºŒã€é«˜çº§é™æµç®—æ³•-æ¼æ–—é™æµ</h2>
<p>æ¼æ–—é™æµæ˜¯æœ€å¸¸ç”¨çš„é™æµæ–¹æ³•ä¹‹ä¸€ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªç®—æ³•çš„çµæ„Ÿæ˜¯æ¥æºäºæ¼æ–—çš„ç»“æ„ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¼æ–—çš„å®¹é‡æ˜¯æœ‰é™çš„ï¼Œå¦‚æœå½“æ¼æ°´çš„é€Ÿåº¦å¤§äºè£…æ°´çš„é€Ÿåº¦æ—¶ï¼Œä¸€åˆ‡æ­£å¸¸ï¼›ä½†æ˜¯å½“æ¼æ°´é€Ÿåº¦å°äºè£…æ°´é€Ÿåº¦æ—¶ï¼Œå°±ä¼šå‡ºç°æ¼æ–—æ»¡äº†ï¼Œæ°´æº¢å‡ºæ¥çš„æƒ…å†µã€‚</p>
<figure data-type="image" tabindex="2"><img src="http://mofish.pily.life/post-images/1626853570223.png" alt="" width="200" height="200" loading="lazy"></figure>
<p>è€Œåœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œ<code>æ¼æ–—çš„å®¹é‡</code>ä»£è¡¨å½“å‰ç”¨æˆ·è¡Œä¸º<code>å¯ä»¥æŒç»­è¿›è¡Œçš„æ•°é‡</code>ï¼Œ<code>æ¼å˜´çš„æµæ°´é€Ÿç‡</code>ä»£è¡¨ç€ç³»ç»Ÿå…è®¸æ”¹<code>è¡Œä¸ºçš„æœ€å¤§é¢‘ç‡</code>ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç¨‹åºä¸­åˆ¤æ–­å½“å‰æ¼æ–—ä¸­æ˜¯å¦æœ‰å……è¶³çš„å®¹é‡æ¥å¤„ç†å½“å‰è¿™æ¬¡ç”¨æˆ·è¡Œä¸ºã€‚</p>
<h4 id="ä»£ç ç¤ºä¾‹-3">ä»£ç ç¤ºä¾‹</h4>
<pre><code class="language-php">&lt;?php


class Funnel
{
    private $capacity;  // æ¼æ–—å®¹é‡
    private $leakingRate; // æ¼å˜´æµæ°´é€Ÿåº¦
    private $leftQuota;  // æ¼æ–—å‰©ä½™ç©ºé—´
    private $leakingTs;  // ä¸Šä¸€æ¬¡æ¼æ°´æ—¶é—´

    public function __construct($capacity, $leakingRate)
    {
        $this-&gt;capacity    = $capacity;
        $this-&gt;leakingRate = $leakingRate;
        $this-&gt;leftQuota   = $capacity;
        $this-&gt;leakingTs   = time();
    }

    /**
     * å¤„ç†ç©ºé—´
     */
    public function makeSpace()
    {
        $nowTs = time();
        // è·ç¦»ä¸Šæ¬¡æ¼æ°´è¿‡å»äº†å¤šä¹…
        $deltaTs = $nowTs - $this-&gt;leakingTs;
        // åˆå¯ä»¥è…¾å‡ºä¸å°‘ç©ºé—´äº†
        $deltaQuota = $deltaTs * $this-&gt;leakingRate;
        if ($deltaQuota &lt; 1) return;

        // å¢åŠ å‰©ä½™ç©ºé—´
        $this-&gt;leftQuota += $deltaQuota;

        // è®°å½•æ¼æ°´æ—¶é—´
        $this-&gt;leakingTs = $nowTs;

        // å‰©ä½™ç©ºé—´ä¸å¾—é«˜äºå®¹é‡
        if ($this-&gt;leftQuota &gt; $this-&gt;capacity) {
            $this-&gt;leftQuota = $this-&gt;capacity;
        }
    }

    /**
     * æµæ°´
     * @param $quota 1 æ¶ˆè€—ä¸€ä¸ªå®¹é‡
     * @return bool
     */
    public function watering($quota) {
        $this-&gt;makeSpace();
        // åˆ¤æ–­å‰©ä½™ç©ºé—´æ˜¯å¦è¶³å¤Ÿ
        if ($this-&gt;leftQuota &gt;= $quota) {
            $this-&gt;leftQuota -= $quota;
            echo date('Y-m-d H:i:s') .': '. $this-&gt;leftQuota. PHP_EOL;
            return true;
        }
        echo date('Y-m-d H:i:s') .': '. 'ä¸å¤Ÿç©ºé—´å•¦' . PHP_EOL;
        return false;
    }
}

$funnels = [];
function isActionAllowed($userId, $action, $capacity, $leakingRate){
    $key = &quot;hist:{$userId}_{$action}&quot;;
    global $funnels;
    if (isset($funnels[$key])) {
        $funnel = $funnels[$key];
    } else {
        $funnel = new Funnel($capacity, $leakingRate);
        $funnels[$key] = $funnel;
    }
    return $funnel-&gt;watering(1);
}


for ($i = 0; $i &lt; 20; $i++) {
    isActionAllowed(10086, 'addComment', 15, '0.5');
    sleep(1);
}
</code></pre>
<!-- more -->
<h4 id="æµç¨‹å›¾">æµç¨‹å›¾</h4>
<figure data-type="image" tabindex="3"><img src="http://mofish.pily.life/post-images/1626853986842.png" alt="" loading="lazy"></figure>
<h4 id="ä¸è¶³">ä¸è¶³</h4>
<p>Funnelå¯¹è±¡ä¸­ï¼Œ<code>makeSpace</code>æ–¹æ³•éƒ½æ¼æ–—ç®—æ³•çš„<code>æ ¸å¿ƒ</code>ï¼Œå…¶åœ¨æ¯æ¬¡æ¼æ°´å‰éƒ½ä¼šè¢«è°ƒç”¨ä»¥è§¦å‘æ¼æ°´ï¼Œç»™æ¼æ–—è…¾ç©ºç©ºé—´æ¥ï¼Œ</p>
<p>èƒ½è…¾å‡ºå¤šå°‘ç©ºé—´å–å†³äºæ—¶é—´è¿‡å»äº†å¤šä¹…ä»¥åŠæµæ°´çš„é€Ÿåº¦ ï¼Œè€Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¼æ–—çš„ç©ºé—´å ç”¨æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä¸ä¼šå› ä¸ºè¡Œä¸ºé¢‘ç‡å¢åŠ è€Œå¢å¤§ã€‚</p>
<p>ä»æµç¨‹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºæ¼æ–—çš„ä¸€ç³»åˆ—æ“ä½œæˆ‘ä»¬<code>æ— æ³•ä¿è¯</code>æ•´ä¸ªè¿‡ç¨‹çš„<code>åŸå­æ€§</code>ï¼Œæ„å‘³ç€éœ€è¦è¿›è¡Œé€‚å½“çš„<code>åŠ é”</code>ï¼Œè€Œä¸€æ—¦åŠ é”ï¼Œå°±æ„å‘³ç€æœ‰åŠ é”æˆ–è§£é”<code>å¤±è´¥çš„å¯èƒ½</code>ï¼Œé™¤æ­¤è¿˜å¾—å¼•å…¥<code>é‡è¯•æœºåˆ¶</code>ï¼Œå¯¼è‡´<code>æ€§èƒ½ä¸‹é™</code>ï¼Œä»£ç <code>å¤æ‚åº¦å¢åŠ </code>ã€‚</p>
<p>å› ä¸ºä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ¬ç« çš„é‡ç‚¹çŸ¥è¯†ç‚¹<code>Redis-Cell</code>ã€‚</p>
<!-- more -->
<h2 id="redis-cell">Redis-Cell</h2>
<p>Redis4.0æä¾›äº†ä¸€ä¸ªé™æµRedisæ¨¡å—ï¼Œå«åšRedis-Cellã€‚è¯¥æ¨¡å—ä¹Ÿä½¿ç”¨äº†æ¼æ–—ç®—æ³•ï¼Œå¹¶æä¾›äº†åŸå­çš„é™æµæŒ‡ä»¤ã€‚</p>
<p>è¯¥æ¨¡å—åªæœ‰ä¸€ä¸ªæŒ‡ä»¤<code>cl.throttle</code>ï¼Œå®ƒå‚æ•°æˆ‘ä»¬ä¸‹é¢è¯´æ˜ä¸€ä¸‹ï¼š</p>
<figure data-type="image" tabindex="4"><img src="http://mofish.pily.life/post-images/1626858821807.png" alt="" loading="lazy"></figure>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæŒ‡ä»¤æ˜¯æ„æ€æ˜¯ï¼šå…è®¸ç”¨æˆ·10086çš„å›å¤è¡Œä¸ºé¢‘ç‡ä¸º60ç§’æœ€å¤š30æ¬¡ï¼ˆæ¼æ°´é€Ÿç‡ï¼‰ï¼Œæ¼æ–—çš„åˆå§‹å®¹é‡ä¸º15ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€å¼€å§‹å¯ä»¥è¿ç»­å›å¤15ä¸ªå¸–å­ï¼Œç„¶åæ‰å¼€å§‹æ”¶æ¼æ°´é€Ÿç‡çš„å½±å“ã€‚</p>
<pre><code>æ³¨æ„ï¼šé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¼æ°´é€Ÿç‡å˜æˆäº†2ä¸ªå‚æ•°ï¼Œç”¨ä¸¤ä¸ªå‚æ•°ç›¸é™¤çš„æ¥å£æ¥è¡¨è¾¾æ¼æ°´é€Ÿç‡ç›¸å¯¹æ¥è¯´æ›´åŠ ç›´è§‚ä¸€äº›ã€‚
</code></pre>
<pre><code class="language-shell">&gt; cl.throttle 10086:addComment 15 30 60
&gt; 1) (integet) 0     # 0 è¡¨ç¤ºå…è®¸  1 è¡¨ç¤ºæ‹’ç»
&gt; 2) (integet) 15   # æ¼æ–—å®¹é‡  capacity
&gt; 3) (integet) 14   # æ¼æ–—å‰©ä½™ç©ºé—´  leftQuota
&gt; 4) (integet) -1    # -1ä»£è¡¨è¿˜æœ‰ç©ºé—´  å¦‚æœè¢«æ‹’ç»äº†ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯éœ€è¦å¤šé•¿æ—¶é—´å†è¯•(å•ä½ç§’)
&gt; 5) (integet) 2     # å¤šé•¿æ—¶é—´åï¼Œæ¼æ–—å®Œå…¨ç©ºå‡ºæ¥(å•ä½ç§’)
</code></pre>
<p>å› æ­¤åœ¨æ‰§è¡Œé™æµæŒ‡ä»¤æ—¶ï¼Œå¦‚æœè¢«æ‹’ç»äº†ï¼Œå°±éœ€è¦ä¸¢å¼ƒæˆ–è€…é‡è¯•ï¼Œä¸€èˆ¬æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ç¬¬4ä¸ªå‚æ•°ï¼ŒæŠŠé‡è¯•å‰©ä½™æ—¶é—´æç¤ºç»™ç”¨æˆ·å³å¯ï¼Œæ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œæ‰€ä»¥ä»¥ä¸Šå°±æ˜¯Redisé™æµçš„ä¸€äº›ç”¨æ³•å•¦ï¼Œå¤§å®¶å¯ä»¥å»å°è¯•ä¸€ä¸‹ã€‚</p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">ä¸‹ä¸€ç¯‡</div>
                <a href="http://mofish.pily.life/post/redis_learning_02/" class="post-title gt-a-link">
                    Rediså­¦ä¹ ä¹‹è·¯(äºŒ)ï¼šå¸ƒéš†è¿‡æ»¤å™¨
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">æ‰“å·¥äººï¼æ‰“å·¥é­‚ï¼æˆ‘çˆ±æ‰“å·¥ï¼</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/myx1002/myx1002.github.io" target="_blank">Moyuxing</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="http://mofish.pily.life/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
